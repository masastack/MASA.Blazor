<div class="masa-table__toolbar">
    <MItemGroup Value="@ActiveView.ToString()"
                ValueChanged="@ActiveChanged"
                Class="masa-table__toolbar-tabs"
                Mandatory
                ActiveClass="active">
        @foreach (var view in Views)
        {
            <MItem Value="@view.Id.ToString()">
                @{
                    var editing = _renamingView == view.Id;
                    var hasAction = !editing && context.Active;
                }
                <MButton Text
                         Large
                         Class="@($"view-tab {context.ActiveClass}")"
                         OnClick="@context.Toggle"
                         Ripple="@(!editing)">

                    <div style="max-width: 160px;"
                         class="text-truncate"
                         title="@view.Name">
                        @if (_renamingView == view.Id)
                        {
                            <MTextField @bind-Value="@_newViewName"
                                        OnBlur="@UpdateViewName"
                                        OnEnter="@UpdateViewName"
                                        Autofocus
                                        Dense
                                        HideDetails="true"
                                        Required
                                        Style="margin-bottom: 5px;">
                            </MTextField>
                        }
                        else
                        {
                            @view.Name
                        }
                    </div>

                    @if (!IsDefaultView)
                    {
                        <Dropdown>
                            <ActivatorContent Context="dropdown">
                                <ExpandXTransition>
                                    <MButton Class="menu"
                                             Small
                                             IconName="mdi-dots-horizontal"
                                             Show="@hasAction"
                                             @attributes="@dropdown.Attrs">
                                    </MButton>
                                </ExpandXTransition>
                            </ActivatorContent>
                            <ChildContent>
                                <DropdownItem PrependIcon="mdi-rename-outline"
                                              Title="Rename view"
                                              OnClick="@(() => RenameView(view))"/>
                                <DropdownItem PrependIcon="mdi-trash-can-outline"
                                              Title="Delete view"
                                              OnClick="@(() => OnViewDelete.InvokeAsync(view))"/>

                            </ChildContent>
                        </Dropdown>
                    }
                </MButton>
            </MItem>
        }

        <MButton IconName="mdi-plus"
                 Class="ml-1"
                 OnClick="@OnViewAdd">
        </MButton>

    </MItemGroup>


    <div class="masa-table__toolbar-actions">
        <MButton LeftIconName="mdi-cog-outline" Text OnClick="@(() => _configDialog = true)">表格配置</MButton>
        <MButton LeftIconName="mdi-filter-variant" Text OnClick="@OnFilterClick">
            <MBadge Value="@HasFilter" Dot Color="red">
                筛选
            </MBadge>
        </MButton>
        <MButton LeftIconName="mdi-sort" Text>排序</MButton>
        <MMenu MinWidth="160">
            <ActivatorContent>
                <MButton LeftIconName="mdi-format-line-spacing"
                         Text
                         @attributes="@context.Attrs">
                    行高
                </MButton>
            </ActivatorContent>
            <ChildContent>
                <MList Dense>
                    <MListItemGroup Value="@((int)RowHeight)"
                                    ValueChanged="@((val) => RowHeightChanged.InvokeAsync((RowHeight)val.AsT1))"
                                    Mandatory
                                    Color="primary">
                        <MListItem Value="0">
                            <ItemContent>
                                <MListItemAction>
                                    <FadeTransition>
                                        <MIcon Dense TransitionShow="@context.Active">mdi-check</MIcon>
                                    </FadeTransition>
                                </MListItemAction>
                                <MListItemContent>
                                    <MListItemTitle>
                                        低
                                    </MListItemTitle>
                                </MListItemContent>
                            </ItemContent>
                        </MListItem>
                        <MListItem Value="1">
                            <ItemContent>
                                <MListItemAction>
                                    <FadeTransition>
                                        <MIcon Dense TransitionShow="@context.Active">mdi-check</MIcon>
                                    </FadeTransition>
                                </MListItemAction>
                                <MListItemContent>
                                    <MListItemTitle>
                                        中
                                    </MListItemTitle>
                                </MListItemContent>
                            </ItemContent>
                        </MListItem>
                        <MListItem Value="2">
                            <ItemContent>
                                <MListItemAction>
                                    <FadeTransition>
                                        <MIcon Dense TransitionShow="@context.Active">mdi-check</MIcon>
                                    </FadeTransition>
                                </MListItemAction>
                                <MListItemContent>
                                    <MListItemTitle>
                                        高
                                    </MListItemTitle>
                                </MListItemContent>
                            </ItemContent>
                        </MListItem>
                    </MListItemGroup>
                </MList>
            </ChildContent>
        </MMenu>
        <MSpacer/>
        @if (IsDefaultView)
        {
            <MButton Color="primary"
                     Depressed
                     OnClick="@OnViewAdd">
                保存为新的视图
            </MButton>
        }
    </div>

</div>

<MDialog @bind-Value="_configDialog" MaxWidth="400">
    <MList Dense Class="masa-table__menu-list">
        <MSortable Items="@Columns"
                   ItemKey="@(column => column.Id)"
                   Order="@ColumnOrder"
                   OrderChanged="@ColumnOrderChanged"
                   Handle=".handle"
                   Context="column">
            @{
                var hidden = HiddenColumnIds.Contains(column.Id);
                var isIgnore = column.Id == Preset.ActionsColumnId;
                var ignoreClass = isIgnore ? "ignore-elements" : "";
            }
            <MListItem Class="@(hidden ? $"grey--text {ignoreClass}" : ignoreClass)">
                <MListItemAction>
                    @if (!isIgnore)
                    {
                        <MIcon Class="handle" Style="cursor: move; color: inherit;">mdi-drag</MIcon>
                    }
                </MListItemAction>
                <MListItemContent>
                    <MListItemTitle Class="d-flex align-center">
                        @Templates.GenTypeIcon(column.Type)
                        <span>@column.Name</span>
                        <MSpacer/>
                        <MToggle Value="@(!hidden)"
                                 DataOn="@("mdi-eye-outline")"
                                 DataOff="@("mdi-eye-off-outline")"
                                 TData="string">
                            <MButton IconName="@context.Data"
                                     Style="color: inherit"
                                     OnClick="@(() => OnColumnToggle.InvokeAsync(column.Id))"/>
                        </MToggle>
                        <MButton IconName="mdi-pencil-outline"
                                 Style="color: inherit"
                                 OnClick="@(() => OnColumnEditClick.InvokeAsync(column))">
                        </MButton>
                    </MListItemTitle>
                </MListItemContent>
            </MListItem>
        </MSortable>
    </MList>
</MDialog>

<MDialog @bind-Value="_filterDialog"
         MaxWidth="400">

    <MButton Outlined Block>Add filter</MButton>
</MDialog>