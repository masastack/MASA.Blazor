@using System.Text.Json
@rendermode InteractiveServer
@inject MasaBlazor MasaBlazor
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

@code {

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var state = await JSRuntime.InvokeAsync<JsonElement>(JsInteropConstants.SsrGetState);
            var isDark = state.GetProperty("dark").GetBoolean();
            Console.Out.WriteLine("isDark = {0}", isDark);

            MasaBlazor.Theme.Dark = !isDark;

            _ = JSRuntime.InvokeVoidAsync(JsInteropConstants.SsrToggleTheme);

            await Task.Delay(1);

            NavigationManager.NavigateTo(NavigationManager.GetUriWithQueryParameters(new Dictionary<string, object?>()
            {
                { "Theme", !isDark ? "Dark" : "Light" },
                { "ThemeTurnDark", null }
            }));
        }
    }

}
