{"version":3,"file":"helper.js","sources":["../../../../Masa.Blazor.JS/src/utils/helper.ts"],"sourcesContent":["const activator_parent_prefix = \"$parent.\";\r\n\r\nexport const IN_BROWSER = typeof window !== 'undefined'\r\n\r\nexport function addOnceEventListener (\r\n  el: EventTarget,\r\n  eventName: string,\r\n  cb: (event: Event) => void,\r\n  options: boolean | AddEventListenerOptions = false\r\n): void {\r\n  const once = (event: Event) => {\r\n    cb(event)\r\n    el.removeEventListener(eventName, once, options)\r\n  }\r\n\r\n  el.addEventListener(eventName, once, options)\r\n}\r\n\r\nlet passiveSupported = false\r\ntry {\r\n  if (IN_BROWSER) {\r\n    const testListenerOpts = Object.defineProperty({}, 'passive', {\r\n      get: () => {\r\n        passiveSupported = true\r\n      },\r\n    })\r\n\r\n    window.addEventListener('testListener' as any, testListenerOpts as any, testListenerOpts)\r\n    window.removeEventListener('testListener' as any, testListenerOpts as any, testListenerOpts)\r\n  }\r\n} catch (e) { console.warn(e) } /* eslint-disable-line no-console */\r\nexport { passiveSupported }\r\n\r\nexport function addPassiveEventListener (\r\n  el: EventTarget,\r\n  event: string,\r\n  cb: ((e: any) => void),\r\n  options: {}\r\n): void {\r\n  el.addEventListener(event, cb, passiveSupported ? options : false)\r\n}\r\n\r\nexport function getZIndex (el?: Element | null): number {\r\n  if (!el || el.nodeType !== Node.ELEMENT_NODE) return 0\r\n\r\n  const index = +window.getComputedStyle(el).getPropertyValue('z-index')\r\n\r\n  if (!index) return getZIndex(el.parentNode as Element)\r\n  return index\r\n}\r\n\r\n// KeyboardEvent.keyCode aliases\r\nexport const keyCodes = Object.freeze({\r\n  enter: 13,\r\n  tab: 9,\r\n  delete: 46,\r\n  esc: 27,\r\n  space: 32,\r\n  up: 38,\r\n  down: 40,\r\n  left: 37,\r\n  right: 39,\r\n  end: 35,\r\n  home: 36,\r\n  del: 46,\r\n  backspace: 8,\r\n  insert: 45,\r\n  pageup: 33,\r\n  pagedown: 34,\r\n  shift: 16,\r\n})\r\n\r\n/**  Polyfill for Event.prototype.composedPath */\r\nexport function composedPath (e: Event): EventTarget[] {\r\n  if (e.composedPath) return e.composedPath()\r\n\r\n  const path = []\r\n  let el = e.target as Element\r\n\r\n  while (el) {\r\n    path.push(el)\r\n\r\n    if (el.tagName === 'HTML') {\r\n      path.push(document)\r\n      path.push(window)\r\n\r\n      return path\r\n    }\r\n\r\n    el = el.parentElement!\r\n  }\r\n  return path\r\n}\r\n\r\nexport function getBlazorId(el) {\r\n  if (!el) {\r\n    return null;\r\n  }\r\n  let _bl_ = el.getAttributeNames().find(a => a.startsWith('_bl_'))\r\n  if (_bl_) {\r\n    _bl_ = _bl_.substring(4);\r\n  }\r\n\r\n  return _bl_;\r\n}\r\n\r\nexport function getElementSelector(el) {\r\n  if (!(el instanceof Element))\r\n    return;\r\n  var path = [];\r\n  while (el.nodeType === Node.ELEMENT_NODE) {\r\n    var selector = el.nodeName.toLowerCase();\r\n    if (el.id) {\r\n      selector = '#' + el.id;\r\n      path.unshift(selector);\r\n      break;\r\n    } else {\r\n      var sib = el, nth = 1;\r\n      while (sib = sib.previousElementSibling) {\r\n        if (sib.nodeName.toLowerCase() == selector)\r\n          nth++;\r\n      }\r\n      if (nth != 1)\r\n        selector += \":nth-of-type(\" + nth + \")\";\r\n    }\r\n    path.unshift(selector);\r\n    el = el.parentNode;\r\n  }\r\n  return path.join(\" > \");\r\n}\r\n\r\nexport function getEventTarget(target: HTMLElement | EventTarget) {\r\n  const el = target as HTMLElement;\r\n  const eventTarget: MbEventTarget = {};\r\n  const elementReferenceId = el\r\n    .getAttributeNames()\r\n    .find((a) => a.startsWith(\"_bl_\"));\r\n  if (elementReferenceId) {\r\n    eventTarget.elementReferenceId = elementReferenceId;\r\n    eventTarget.selector = `[${elementReferenceId}]`;\r\n  } else {\r\n    eventTarget.selector = getElementSelector(el);\r\n  }\r\n\r\n  eventTarget.class = el.getAttribute(\"class\");\r\n\r\n  return eventTarget;\r\n}\r\n\r\nexport function getElement(elOrString: HTMLElement | string): HTMLElement {\r\n  if (typeof elOrString === \"string\") {\r\n    return document.querySelector(elOrString);\r\n  } else {\r\n    return elOrString;\r\n  }\r\n}\r\n\r\nexport function getDom(elOrString: Element | string | undefined) {\r\n  let element: HTMLElement;\r\n\r\n  try {\r\n    if (!elOrString) {\r\n      element = document.body;\r\n    } else if (typeof elOrString === \"string\") {\r\n      if (elOrString === \"document\") {\r\n        element = document.documentElement;\r\n      } else if (elOrString.indexOf(\"__.__\") > 0) {\r\n        // for example: el__.__parentElement\r\n        let array = elOrString.split(\"__.__\");\r\n        let i = 0;\r\n        let el = document.querySelector(array[i++]);\r\n\r\n        if (el) {\r\n          while (array[i]) {\r\n            el = el[array[i]];\r\n            i++;\r\n          }\r\n        }\r\n\r\n        if (el instanceof HTMLElement) {\r\n          element = el;\r\n        }\r\n      } else {\r\n        element = document.querySelector(elOrString);\r\n      }\r\n    } else {\r\n      element = elOrString as HTMLElement;\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error(error)\r\n  }\r\n\r\n  return element;\r\n}\r\n\r\nexport const canUseDom = !!(\r\n  IN_BROWSER &&\r\n  typeof document !== 'undefined' &&\r\n  window.document &&\r\n  window.document.createElement\r\n)\r\n\r\nexport function convertToUnit (str: number, unit?: string): string\r\nexport function convertToUnit (str: string | number | null | undefined, unit?: string): string | undefined\r\nexport function convertToUnit (str: string | number | null | undefined, unit = 'px'): string | undefined {\r\n  if (str == null || str === '') {\r\n    return undefined\r\n  } else if (isNaN(+str!)) {\r\n    return String(str)\r\n  } else if (!isFinite(+str!)) {\r\n    return undefined\r\n  } else {\r\n    return `${Number(str)}${unit}`\r\n  }\r\n}\r\n\r\nexport function getActivator(selector: string): HTMLElement | null {\r\n  if (selector.startsWith(activator_parent_prefix)) {\r\n    const parentSelector = selector.replace(activator_parent_prefix, \"\");\r\n    const parentElement = document.querySelector(parentSelector)?.parentElement;\r\n    if (!parentElement) {\r\n      return null;\r\n    }\r\n\r\n    // special case for MButton component\r\n    if (parentElement.classList.contains('m-btn__content')) {\r\n      return parentElement.parentElement as HTMLElement;\r\n    }\r\n\r\n    return parentElement;\r\n  } else {\r\n    return document.querySelector(selector);\r\n  }\r\n}"],"names":[],"mappings":"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"}