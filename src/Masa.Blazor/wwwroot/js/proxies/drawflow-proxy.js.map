{"version":3,"file":"drawflow-proxy.js","sources":["../../../../BlazorComponent/src/Component/BlazorComponent.Web/src/proxies/drawflow/index.ts"],"sourcesContent":["import DrawflowClass, { DrawFlowEditorMode, DrawflowModuleData } from \"drawflow\";\r\n\r\ndeclare const Drawflow: DrawflowClass;\r\n\r\nclass DrawflowProxy {\r\n  editor: DrawflowClass;\r\n  dotnetHelper: DotNet.DotNetObject;\r\n\r\n  mousedown = new MouseEvent(\"mousedown\", {\r\n    view: window,\r\n    bubbles: true,\r\n    cancelable: false,\r\n  });\r\n\r\n  mouseup = new MouseEvent(\"mouseup\", {\r\n    view: window,\r\n    bubbles: true,\r\n    cancelable: false,\r\n  });\r\n\r\n  constructor(\r\n    selector: string,\r\n    dotnetHelper: DotNet.DotNetObject,\r\n    mode: DrawFlowEditorMode\r\n  ) {\r\n    var el = document.querySelector<HTMLElement>(selector);\r\n    this.editor = new (Drawflow as any)(el);\r\n    this.editor.start();\r\n    this.editor.editor_mode = mode;\r\n    const that = this;\r\n\r\n    this.editor.on(\"nodeCreated\", function (id) {\r\n      dotnetHelper.invokeMethodAsync(\"OnNodeCreated\", id.toString());\r\n    });\r\n\r\n    this.editor.on(\"nodeRemoved\", function (id) {\r\n      dotnetHelper.invokeMethodAsync(\"OnNodeRemoved\", id.toString());\r\n    });\r\n\r\n    this.editor.on(\"nodeSelected\", function (id) {\r\n      dotnetHelper.invokeMethodAsync(\"OnNodeSelected\", id.toString());\r\n    });\r\n\r\n    this.editor.on(\"nodeUnselected\", function (id) {\r\n      dotnetHelper.invokeMethodAsync(\"OnNodeUnselected\", id.toString());\r\n    });\r\n\r\n    this.editor.on(\"nodeDataChanged\" as any, function (id) {\r\n      dotnetHelper.invokeMethodAsync(\"OnNodeDataChanged\", id.toString());\r\n    });\r\n\r\n    this.editor.on(\"import\", function (e) {\r\n      dotnetHelper.invokeMethodAsync(\"OnImport\");\r\n    });\r\n  }\r\n\r\n  setMode(mode: DrawFlowEditorMode) {\r\n    this.editor.editor_mode = mode;\r\n  }\r\n\r\n  addNode(\r\n    name: string,\r\n    inputs: number,\r\n    outputs: number,\r\n    clientX: number,\r\n    clientY: number,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    className: string,\r\n    data: object = {},\r\n    html: string\r\n  ) {\r\n    if (this.editor.editor_mode == \"fixed\") {\r\n      return null;\r\n    }\r\n\r\n    const posX =\r\n      clientX *\r\n        (this.editor.precanvas.clientWidth /\r\n          (this.editor.precanvas.clientWidth * this.editor.zoom)) -\r\n      this.editor.precanvas.getBoundingClientRect().x *\r\n        (this.editor.precanvas.clientWidth /\r\n          (this.editor.precanvas.clientWidth * this.editor.zoom)) -\r\n      offsetX;\r\n\r\n    const posY =\r\n      clientY *\r\n        (this.editor.precanvas.clientHeight /\r\n          (this.editor.precanvas.clientHeight * this.editor.zoom)) -\r\n      this.editor.precanvas.getBoundingClientRect().y *\r\n        (this.editor.precanvas.clientHeight /\r\n          (this.editor.precanvas.clientHeight * this.editor.zoom)) -\r\n      offsetY;\r\n\r\n    var nodeId = this.editor.addNode(\r\n      name,\r\n      inputs,\r\n      outputs,\r\n      posX,\r\n      posY,\r\n      className,\r\n      data,\r\n      html,\r\n      false\r\n    );\r\n\r\n    return nodeId.toString();\r\n  }\r\n\r\n  removeNodeId(id: string) {\r\n    this.editor.removeNodeId(id);\r\n  }\r\n\r\n  getNodeFromId(id: string) {\r\n    const node: any = this.editor.getNodeFromId(id);\r\n    node[\"id\"] = node.id.toString();\r\n    return node;\r\n  }\r\n\r\n  updateNodeDataFromId(id: string, data: object) {\r\n    this.editor.updateNodeDataFromId(id, data);\r\n    (this.editor as any).dispatch(\"nodeDataChanged\", id);\r\n  }\r\n\r\n  updateNodeHtml(id: string, html: string) {\r\n    this.editor.drawflow.drawflow.Home.data[id].html = html;\r\n  }\r\n\r\n  addNodeInput(id: string) {\r\n    this.editor.addNodeInput(id);\r\n  }\r\n\r\n  addNodeOutput(id: string) {\r\n    this.editor.addNodeOutput(id);\r\n  }\r\n\r\n  removeNodeInput(id: string, inputClass: string) {\r\n    this.editor.removeNodeInput(id, inputClass);\r\n  }\r\n\r\n  removeNodeOutput(id: string, outputClass: string) {\r\n    this.editor.removeNodeOutput(id, outputClass);\r\n  }\r\n\r\n  clear() {\r\n    this.editor.clear();\r\n  }\r\n\r\n  export(indented: boolean = false) {\r\n    const res = this.editor.export();\r\n    return JSON.stringify(res, null, indented ? 2 : null);\r\n  }\r\n\r\n  import(json: string) {\r\n    const data = JSON.parse(json);\r\n    this.editor.import(data);\r\n  }\r\n\r\n  focusNode(id: string) {\r\n    document\r\n      .querySelector(`#node-${id} .drawflow_content_node`)\r\n      .dispatchEvent(this.mousedown);\r\n    document\r\n      .querySelector(`#node-${id} .drawflow_content_node`)\r\n      .dispatchEvent(this.mouseup);\r\n  }\r\n\r\n  centerNode(id: string, animate: boolean) {\r\n    const node = document.getElementById(`node-${id}`);\r\n    const args = {\r\n      node_x: this.editor.drawflow.drawflow.Home.data[id].pos_x,\r\n      node_y: this.editor.drawflow.drawflow.Home.data[id].pos_y,\r\n      node_w: node.clientWidth,\r\n      node_h: node.clientHeight,\r\n      canvas_w: this.editor.precanvas.clientWidth,\r\n      canvas_h: this.editor.precanvas.clientHeight,\r\n    };\r\n    const pos_x = -args.node_x + args.canvas_w / 2 - args.node_w / 2;\r\n    const pos_y = -args.node_y + args.canvas_h / 2 - args.node_h / 2;\r\n    const zoom = this.editor.zoom;\r\n    this.setTranslate(pos_x, pos_y, zoom);\r\n\r\n    if (animate) {\r\n      const millisecondsStart = 50;\r\n      const millisecondsAnimate = 500;\r\n      node.style.transition = `all ${millisecondsAnimate / 1000}s ease 0s`;\r\n      window.setTimeout(() => {\r\n        node.style.transform = \"scale(1.1)\";\r\n      }, millisecondsStart);\r\n      window.setTimeout(() => {\r\n        node.style.transform = \"scale(1.0)\";\r\n      }, millisecondsStart + millisecondsAnimate);\r\n      window.setTimeout(() => {\r\n        node.style.transition = \"\";\r\n        node.style.transform = \"\";\r\n      }, millisecondsStart + millisecondsAnimate * 2);\r\n    }\r\n\r\n    this.focusNode(id);\r\n  }\r\n\r\n  setTranslate(x: number, y: number, zoom: number) {\r\n    this.editor.canvas_x = x;\r\n    this.editor.canvas_y = y;\r\n    let storedZoom = zoom;\r\n    this.editor.zoom = 1;\r\n    this.editor.precanvas.style.transform =\r\n      \"translate(\" +\r\n      this.editor.canvas_x +\r\n      \"px, \" +\r\n      this.editor.canvas_y +\r\n      \"px) scale(\" +\r\n      this.editor.zoom +\r\n      \")\";\r\n    this.editor.zoom = storedZoom;\r\n    this.editor.zoom_last_value = 1;\r\n    this.editor.zoom_refresh();\r\n  }\r\n}\r\n\r\nfunction init(\r\n  selector: string,\r\n  dotNetHelper: DotNet.DotNetObject,\r\n  mode: DrawFlowEditorMode = \"edit\"\r\n) {\r\n  return new DrawflowProxy(selector, dotNetHelper, mode);\r\n}\r\n\r\nexport { init };\r\n"],"names":["DrawflowProxy","constructor","selector","dotnetHelper","mode","this","mousedown","MouseEvent","view","window","bubbles","cancelable","mouseup","el","document","querySelector","editor","Drawflow","start","editor_mode","on","id","invokeMethodAsync","toString","e","setMode","addNode","name","inputs","outputs","clientX","clientY","offsetX","offsetY","className","data","html","posX","precanvas","clientWidth","zoom","getBoundingClientRect","x","posY","clientHeight","y","removeNodeId","getNodeFromId","node","updateNodeDataFromId","dispatch","updateNodeHtml","drawflow","Home","addNodeInput","addNodeOutput","removeNodeInput","inputClass","removeNodeOutput","outputClass","clear","export","indented","res","JSON","stringify","import","json","parse","focusNode","dispatchEvent","centerNode","animate","getElementById","args","pos_x","pos_y","setTranslate","millisecondsStart","millisecondsAnimate","style","transition","setTimeout","transform","canvas_x","canvas_y","storedZoom","zoom_last_value","zoom_refresh","init","dotNetHelper"],"mappings":"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"}