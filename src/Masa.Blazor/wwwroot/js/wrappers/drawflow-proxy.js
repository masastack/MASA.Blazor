function t(t){return{detail:t.detail,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,pageX:t.pageX,pageY:t.pageY,button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,type:t.type}}class e{constructor(e,o,n){this.connectionCancelFlag=!1,this.mousedown=new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!1}),this.mouseup=new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!1}),this.connectionStart=t=>{this.connectionStartPayload={outputId:t.output_id,outputClass:t.output_class},this.dotnetHelper.invokeMethodAsync("OnConnectionStart",this.connectionStartPayload)},this.connectionCancel=t=>{this.connectionCancelFlag=!0,this.dotnetHelper.invokeMethodAsync("OnConnectionCancel")},this.mouseUp=e=>{var o=t(e);this.dotnetHelper.invokeMethodAsync("OnMouseUp",Object.assign(Object.assign({},o),{connectionStart:this.connectionCancelFlag?this.connectionStartPayload:null})),this.connectionCancelFlag=!1};var i=document.querySelector(e);this.editor=new Drawflow(i),this.editor.start(),this.editor.editor_mode=n,this.dotnetHelper=o,this.editor.on("nodeCreated",function(t){o.invokeMethodAsync("OnNodeCreated",t.toString())}),this.editor.on("nodeRemoved",function(t){o.invokeMethodAsync("OnNodeRemoved",t.toString())}),this.editor.on("nodeSelected",function(t){o.invokeMethodAsync("OnNodeSelected",t.toString())}),this.editor.on("nodeUnselected",function(t){o.invokeMethodAsync("OnNodeUnselected",t.toString())}),this.editor.on("nodeDataChanged",function(t){o.invokeMethodAsync("OnNodeDataChanged",t.toString())}),this.editor.on("import",function(t){o.invokeMethodAsync("OnImport")}),this.editor.on("contextmenu",function(e){const n=t(e);console.log("contextmenu event triggered",e,n),o.invokeMethodAsync("OnContextmenu",n)}),this.editor.on("connectionStart",this.connectionStart),this.editor.on("connectionCancel",this.connectionCancel),this.editor.on("mouseUp",this.mouseUp)}setMode(t){this.editor.editor_mode=t}addNode(t,e,o,n,i,d,s,r,a={},c){if("fixed"==this.editor.editor_mode)return null;const h=n*(this.editor.precanvas.clientWidth/(this.editor.precanvas.clientWidth*this.editor.zoom))-this.editor.precanvas.getBoundingClientRect().x*(this.editor.precanvas.clientWidth/(this.editor.precanvas.clientWidth*this.editor.zoom))-d,l=i*(this.editor.precanvas.clientHeight/(this.editor.precanvas.clientHeight*this.editor.zoom))-this.editor.precanvas.getBoundingClientRect().y*(this.editor.precanvas.clientHeight/(this.editor.precanvas.clientHeight*this.editor.zoom))-s;return this.editor.addNode(t,e,o,h,l,r,a,c,!1).toString()}removeNodeId(t){this.editor.removeNodeId(t)}getNodeFromId(t){const e=this.editor.getNodeFromId(t);return e.id=e.id.toString(),e}updateNodeDataFromId(t,e){this.editor.updateNodeDataFromId(t,e),this.editor.dispatch("nodeDataChanged",t)}updateNodeHtml(t,e){this.editor.drawflow.drawflow.Home.data[t].html=e}addNodeInput(t){this.editor.addNodeInput(t)}addNodeOutput(t){this.editor.addNodeOutput(t)}removeNodeInput(t,e){this.editor.removeNodeInput(t,e)}removeNodeOutput(t,e){this.editor.removeNodeOutput(t,e)}updateConnectionNodes(t){this.editor.updateConnectionNodes(t)}removeConnectionNodeId(t){this.editor.removeConnectionNodeId(t)}addConnection(t,e,o,n){this.editor.addConnection(t,e,o,n)}clear(){this.editor.clear()}export(t=!1){const e=this.editor.export();return JSON.stringify(e,null,t?2:null)}import(t){const e=JSON.parse(t);this.editor.import(e)}focusNode(t){document.querySelector(`#node-${t} .drawflow_content_node`).dispatchEvent(this.mousedown),document.querySelector(`#node-${t} .drawflow_content_node`).dispatchEvent(this.mouseup)}centerNode(t,e){const o=document.getElementById(`node-${t}`),n=this.editor.drawflow.drawflow.Home.data[t].pos_x,i=this.editor.drawflow.drawflow.Home.data[t].pos_y,d=o.clientWidth,s=o.clientHeight,r=this.editor.precanvas.clientWidth/2-n-d/2,a=this.editor.precanvas.clientHeight/2-i-s/2,c=this.editor.zoom;if(this.setTranslate(r,a,c),e){const t=50,e=500;o.style.transition=`all ${e/1e3}s ease 0s`,window.setTimeout(()=>{o.style.transform="scale(1.1)"},t),window.setTimeout(()=>{o.style.transform="scale(1.0)"},t+e),window.setTimeout(()=>{o.style.transition="",o.style.transform=""},t+2*e)}this.focusNode(t)}setTranslate(t,e,o){this.editor.canvas_x=t,this.editor.canvas_y=e;let n=o;this.editor.zoom=1,this.editor.precanvas.style.transform="translate("+this.editor.canvas_x+"px, "+this.editor.canvas_y+"px) scale("+this.editor.zoom+")",this.editor.zoom=n,this.editor.zoom_last_value=1,this.editor.zoom_refresh()}}function o(t,o,n="edit"){return new e(t,o,n)}export{o as init};
