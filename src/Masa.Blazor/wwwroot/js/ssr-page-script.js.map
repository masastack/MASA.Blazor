{"version":3,"file":"ssr-page-script.js","sources":["../../../BlazorComponent/src/Component/BlazorComponent.Web/src/ssr/index.ts","../../../BlazorComponent/src/Component/BlazorComponent.Web/src/ssr/page-script.ts"],"sourcesContent":["export type MasaBlazorApplication = {\r\n  bar?: number;\r\n  top: number;\r\n  right: number;\r\n  bottom: number;\r\n  left: number;\r\n  footer?: number;\r\n  insetFooter?: number;\r\n};\r\n\r\nexport type MasaBlazorSsrPassiveState = {\r\n  application: MasaBlazorApplication;\r\n};\r\n\r\nexport type MasaBlazorSsrState = {\r\n  culture?: string;\r\n  rtl?: boolean;\r\n  dark?: boolean;\r\n  passive: MasaBlazorSsrPassiveState;\r\n};\r\n\r\nexport const MASA_BLAZOR_SSR_STATE = \"masablazor@ssr-state\";\r\n\r\nexport function setTheme(dark: boolean) {\r\n  console.log(\"[index.ts] setTheme\", dark);\r\n  const selector = `.${getThemeCss(!dark)}:not(.theme--independent)`\r\n  const elements = document.querySelectorAll(selector);\r\n  for (let i = 0; i < elements.length; i++) {\r\n    elements[i].classList.remove(getThemeCss(!dark));\r\n    elements[i].classList.add(getThemeCss(dark));\r\n  }\r\n\r\n  updateStorage({ dark });\r\n}\r\n\r\nexport function setCulture(culture: string) {\r\n  console.log(\"[index.ts] setCulture\", culture);\r\n  const app = getApp();\r\n  if (!app) return;\r\n\r\n  updateStorage({ culture });\r\n}\r\n\r\nexport function setRtl(rtl: boolean, updateCache: boolean = true) {\r\n  console.log(\"[index.ts] setRtl\", rtl);\r\n  const app = getApp();\r\n  if (!app) return;\r\n\r\n  const rtlCss = \"m-application--is-rtl\";\r\n  if (!rtl) {\r\n    app.classList.remove(rtlCss);\r\n  } else if (!app.classList.contains(rtlCss)) {\r\n    app.classList.add(rtlCss);\r\n  }\r\n\r\n  if (updateCache) {\r\n    updateStorage({ rtl });\r\n  }\r\n}\r\n\r\nexport function updateMain(application: MasaBlazorApplication) {\r\n  const main: HTMLElement = document.querySelector(\".m-main\");\r\n\r\n  const newApplication: MasaBlazorApplication = {\r\n    top: application.top ?? getPadding(\"Top\"),\r\n    right: application.right ?? getPadding(\"Right\"),\r\n    bottom: application.bottom ?? getPadding(\"Bottom\"),\r\n    left: application.left ?? getPadding(\"Left\"),\r\n  };\r\n\r\n  restoreMain(newApplication);\r\n\r\n  function getPadding(prop: \"Top\" | \"Right\" | \"Bottom\" | \"Left\") {\r\n    return Number(main.style[`padding${prop}`].match(/\\d+/)[0]);\r\n  }\r\n}\r\n\r\nexport function updatePassiveState(passive: MasaBlazorSsrPassiveState) {\r\n  const oldState = getState() ?? {};\r\n  const state: MasaBlazorSsrState = {\r\n    ...oldState,\r\n    passive,\r\n  };\r\n  console.log(\"[updatePassiveState] state\", state);\r\n  localStorage.setItem(MASA_BLAZOR_SSR_STATE, JSON.stringify(state));\r\n}\r\n\r\nexport function getThemeCss(dark: boolean) {\r\n  return dark ? \"theme--dark\" : \"theme--light\";\r\n}\r\n\r\nfunction getApp() {\r\n  return document.querySelector(\".m-application\");\r\n}\r\n\r\nfunction updateStorage(obj: Partial<MasaBlazorSsrState>) {\r\n  const stateStr = localStorage.getItem(MASA_BLAZOR_SSR_STATE);\r\n  if (stateStr) {\r\n    const state = JSON.parse(stateStr);\r\n    localStorage.setItem(\r\n      MASA_BLAZOR_SSR_STATE,\r\n      JSON.stringify({\r\n        ...state,\r\n        ...obj,\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nexport function restoreMain(application: MasaBlazorApplication) {\r\n  const main = document.querySelector(\".m-main\") as HTMLElement;\r\n  if (main && application) {\r\n    main.style.paddingTop = application.top + application.bar + \"px\";\r\n    main.style.paddingRight = application.right + \"px\";\r\n    main.style.paddingBottom =\r\n      application.bottom + application.insetFooter + application.bottom + \"px\";\r\n    main.style.paddingLeft = application.left + \"px\";\r\n  }\r\n}\r\n\r\nexport function getState(): MasaBlazorSsrState {\r\n  const stateStr = localStorage.getItem(MASA_BLAZOR_SSR_STATE);\r\n  if (stateStr) {\r\n    return JSON.parse(stateStr);\r\n  }\r\n  return null;\r\n}\r\n","import { getThemeCss, MASA_BLAZOR_SSR_STATE, MasaBlazorSsrState, restoreMain, setRtl } from \"./\";\r\n\r\nlet firstUpdate = true;\r\n\r\n// Called when the script first gets loaded on the page.\r\nexport function onLoad() {}\r\n\r\n// Called when an enhanced page update occurs, plus once immediately after\r\n// the initial load.\r\nexport function onUpdate() {\r\n  if (firstUpdate) {\r\n    firstUpdate = false;\r\n    return;\r\n  }\r\n\r\n  console.log(\"Update\");\r\n\r\n  const stateStr = localStorage.getItem(MASA_BLAZOR_SSR_STATE);\r\n  console.log(\"[Update] stateStr\", stateStr);\r\n  if (!stateStr) return;\r\n\r\n  const state: MasaBlazorSsrState = JSON.parse(stateStr);\r\n  if (!state) return;\r\n\r\n  console.log(\"[Update] state\", state);\r\n\r\n  restoreMain(state.passive.application);\r\n  restoreTheme(state);\r\n  restoreRtl(state);\r\n}\r\n\r\n// Called when an enhanced page update removes the script from the page.\r\nexport function onDispose() {\r\n  console.log(\"Dispose\");\r\n}\r\n\r\nexport function restoreTheme(state: MasaBlazorSsrState) {\r\n  console.log(\"restoreTheme\", state);\r\n  if (typeof state.dark === \"boolean\") {\r\n    const selector = `.${getThemeCss(!state.dark)}:not(.theme--independent)`\r\n    const elements = document.querySelectorAll(selector);\r\n    for (let i = 0; i < elements.length; i++) {\r\n      elements[i].classList.remove(getThemeCss(!state.dark));\r\n      elements[i].classList.add(getThemeCss(state.dark));\r\n    }\r\n  }\r\n}\r\n\r\nexport function restoreRtl(state: MasaBlazorSsrState) {\r\n  console.log(\"restoreRtl\", state);\r\n  if (typeof state.rtl === \"boolean\") {\r\n    setRtl(state.rtl, false);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}