{"version":3,"file":"ssr-page-script.js","sources":["../../../BlazorComponent/src/Component/BlazorComponent.Web/src/ssr/index.ts","../../../BlazorComponent/src/Component/BlazorComponent.Web/src/ssr/page-script.ts"],"sourcesContent":["export type MasaBlazorApplication = {\r\n  bar?: number;\r\n  top: number;\r\n  right: number;\r\n  bottom: number;\r\n  left: number;\r\n  footer?: number;\r\n  insetFooter?: number;\r\n};\r\n\r\nexport type MasaBlazorSsrPassiveState = {\r\n  application: MasaBlazorApplication;\r\n};\r\n\r\nexport type MasaBlazorSsrState = {\r\n  culture?: string;\r\n  rtl: boolean;\r\n  dark: boolean;\r\n  passive: MasaBlazorSsrPassiveState;\r\n};\r\n\r\nexport const MASA_BLAZOR_SSR_STATE = \"masablazor@ssr-state\";\r\n\r\nexport function setTheme(dark: boolean) {\r\n  console.log(\"[index.ts] setTheme\", dark);\r\n  const app = getApp();\r\n  if (app) {\r\n    app.classList.replace(getThemeCss(!dark), getThemeCss(dark));\r\n  }\r\n\r\n  updateStorage({ dark });\r\n}\r\n\r\nexport function setRtl(culture: string) {\r\n  console.log(\"[index.ts] setCulture\", culture);\r\n  const app = getApp();\r\n  if (!app) return;\r\n\r\n  updateStorage({ culture });\r\n}\r\n\r\nexport function setCulture(rtl: boolean) {\r\n  console.log(\"[index.ts] setRtl\", rtl);\r\n  const app = getApp();\r\n  if (!app) return;\r\n\r\n  const rtlCss = \"m-application--is-rtl\";\r\n  if (!rtl) {\r\n    app.classList.remove(rtlCss);\r\n  } else if (!app.classList.contains(rtlCss)) {\r\n    app.classList.add(rtlCss);\r\n  }\r\n\r\n  updateStorage({ rtl });\r\n}\r\n\r\nexport function updateMain(application: MasaBlazorApplication) {\r\n  const main: HTMLElement = document.querySelector(\".m-main\");\r\n\r\n  const newApplication: MasaBlazorApplication = {\r\n    top: application.top ?? getPadding(\"Top\"),\r\n    right: application.right ?? getPadding(\"Right\"),\r\n    bottom: application.bottom ?? getPadding(\"Bottom\"),\r\n    left: application.left ?? getPadding(\"Left\"),\r\n  };\r\n\r\n  restoreMain(newApplication);\r\n\r\n  function getPadding(prop: \"Top\" | \"Right\" | \"Bottom\" | \"Left\") {\r\n    return Number(main.style[`padding${prop}`].match(/\\d+/)[0]);\r\n  }\r\n}\r\n\r\nexport function saveState(state: MasaBlazorSsrState) {\r\n  console.log(\"saveMain\", state);\r\n  localStorage.setItem(MASA_BLAZOR_SSR_STATE, JSON.stringify(state));\r\n}\r\n\r\nfunction getThemeCss(dark: boolean) {\r\n  return dark ? \"theme--dark\" : \"theme--light\";\r\n}\r\n\r\nfunction getApp() {\r\n  return document.querySelector(\".m-application\");\r\n}\r\n\r\nfunction updateStorage(obj: Partial<MasaBlazorSsrState>) {\r\n  const stateStr = localStorage.getItem(MASA_BLAZOR_SSR_STATE);\r\n  if (stateStr) {\r\n    const state = JSON.parse(stateStr);\r\n    localStorage.setItem(\r\n      MASA_BLAZOR_SSR_STATE,\r\n      JSON.stringify({\r\n        ...state,\r\n        ...obj,\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nexport function restoreMain(application: MasaBlazorApplication) {\r\n  const main = document.querySelector(\".m-main\") as HTMLElement;\r\n  if (main && application) {\r\n    main.style.paddingTop = application.top + application.bar + \"px\";\r\n    main.style.paddingRight = application.right + \"px\";\r\n    main.style.paddingBottom =\r\n      application.bottom + application.insetFooter + application.bottom + \"px\";\r\n    main.style.paddingLeft = application.left + \"px\";\r\n  }\r\n}\r\n\r\nexport function getState(): MasaBlazorSsrState {\r\n  const stateStr = localStorage.getItem(MASA_BLAZOR_SSR_STATE);\r\n  if (stateStr) {\r\n    return JSON.parse(stateStr);\r\n  }\r\n  return null;\r\n}\r\n","import { MASA_BLAZOR_SSR_STATE, MasaBlazorApplication, MasaBlazorSsrState, restoreMain } from \"./\";\n\nlet firstUpdate = true;\n\n// Called when the script first gets loaded on the page.\nexport function onLoad() {}\n\n// Called when an enhanced page update occurs, plus once immediately after\n// the initial load.\nexport function onUpdate() {\n  if (firstUpdate) {\n    firstUpdate = false;\n    return;\n  }\n\n  console.log(\"Update\");\n\n  const stateStr = localStorage.getItem(MASA_BLAZOR_SSR_STATE);\n  console.log(\"[Update] stateStr\", stateStr);\n  if (!stateStr) return;\n\n  const state: MasaBlazorSsrState = JSON.parse(stateStr);\n  if (!state) return;\n\n  console.log(\"[Update] state\", state);\n\n  restoreMain(state.passive.application);\n  restoreTheme(state);\n  restoreRtl(state);\n}\n\n// Called when an enhanced page update removes the script from the page.\nexport function onDispose() {\n  console.log(\"Dispose\");\n}\n\nfunction restoreTheme(state: MasaBlazorSsrState) {\n  console.log(\"restoreTheme\", state);\n  if (typeof state.dark === \"boolean\") {\n    window.BlazorComponent.interop.ssr.setTheme(state.dark);\n  }\n}\n\nfunction restoreRtl(state: MasaBlazorSsrState) {\n  console.log(\"restoreRtl\", state);\n  if (typeof state.rtl === \"boolean\") {\n    window.BlazorComponent.interop.ssr.setRtl(state.rtl);\n  }\n}\n"],"names":[],"mappings":"AAqBO,MAAM,qBAAqB,GAAG,sBAAsB,CAAC;AA+EtD,SAAU,WAAW,CAAC,WAAkC,EAAA;IAC5D,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAgB,CAAC;IAC9D,IAAI,IAAI,IAAI,WAAW,EAAE;AACvB,QAAA,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,WAAW,CAAC,GAAG,GAAG,WAAW,CAAC,GAAG,GAAG,IAAI,CAAC;QACjE,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,WAAW,CAAC,KAAK,GAAG,IAAI,CAAC;QACnD,IAAI,CAAC,KAAK,CAAC,aAAa;AACtB,YAAA,WAAW,CAAC,MAAM,GAAG,WAAW,CAAC,WAAW,GAAG,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC;QAC3E,IAAI,CAAC,KAAK,CAAC,WAAW,GAAG,WAAW,CAAC,IAAI,GAAG,IAAI,CAAC;AAClD,KAAA;AACH;;AC3GA,IAAI,WAAW,GAAG,IAAI,CAAC;AAEvB;AACM,SAAU,MAAM,GAAA,GAAK;AAE3B;AACA;SACgB,QAAQ,GAAA;AACtB,IAAA,IAAI,WAAW,EAAE;QACf,WAAW,GAAG,KAAK,CAAC;QACpB,OAAO;AACR,KAAA;AAED,IAAA,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAEtB,MAAM,QAAQ,GAAG,YAAY,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC7D,IAAA,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,QAAQ,CAAC,CAAC;AAC3C,IAAA,IAAI,CAAC,QAAQ;QAAE,OAAO;IAEtB,MAAM,KAAK,GAAuB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;AACvD,IAAA,IAAI,CAAC,KAAK;QAAE,OAAO;AAEnB,IAAA,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;AAErC,IAAA,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;IACvC,YAAY,CAAC,KAAK,CAAC,CAAC;IACpB,UAAU,CAAC,KAAK,CAAC,CAAC;AACpB,CAAC;AAED;SACgB,SAAS,GAAA;AACvB,IAAA,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACzB,CAAC;AAED,SAAS,YAAY,CAAC,KAAyB,EAAA;AAC7C,IAAA,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC;AACnC,IAAA,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,SAAS,EAAE;AACnC,QAAA,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AACzD,KAAA;AACH,CAAC;AAED,SAAS,UAAU,CAAC,KAAyB,EAAA;AAC3C,IAAA,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;AACjC,IAAA,IAAI,OAAO,KAAK,CAAC,GAAG,KAAK,SAAS,EAAE;AAClC,QAAA,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACtD,KAAA;AACH;;;;"}