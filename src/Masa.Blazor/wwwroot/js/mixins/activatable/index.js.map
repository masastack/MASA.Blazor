{"version":3,"file":"index.js","sources":["../../../../../Masa.Blazor.JS/src/mixins/delayable.ts","../../../../../Masa.Blazor.JS/src/mixins/activatable.ts"],"sourcesContent":["export default class Delayable {\r\n  openDelay: number;\r\n  closeDelay: number;\r\n  dotNetHelper: DotNet.DotNetObject;\r\n\r\n  openTimeout;\r\n  closeTimeout;\r\n  isActive: boolean;\r\n\r\n  constructor(\r\n    openDelay: number,\r\n    closeDelay: number,\r\n    dotNetHelper: DotNet.DotNetObject\r\n  ) {\r\n    this.openDelay = openDelay;\r\n    this.closeDelay = closeDelay;\r\n    this.dotNetHelper = dotNetHelper;\r\n  }\r\n\r\n  clearDelay() {\r\n    clearTimeout(this.openTimeout);\r\n    clearTimeout(this.closeTimeout);\r\n  }\r\n\r\n  runDelay(type: \"open\" | \"close\", cb?: () => void) {\r\n    this.clearDelay();\r\n\r\n    const delay = parseInt((this as any)[`${type}Delay`], 10);\r\n\r\n    (this as any)[`${type}Timeout`] = setTimeout(\r\n      cb ||\r\n        (() => {\r\n          const isActive = { open: true, close: false }[type];\r\n          this.setActive(isActive);\r\n        }),\r\n      delay\r\n    );\r\n  }\r\n\r\n  setActive(active: boolean) {\r\n    if (this.isActive == active) {\r\n      return;\r\n    }\r\n\r\n    this.isActive = active;\r\n    this.dotNetHelper.invokeMethodAsync(\"SetActive\", this.isActive);\r\n  }\r\n\r\n  resetDelay(openDelay: number, closeDelay: number) {\r\n    this.openDelay = openDelay;\r\n    this.closeDelay = closeDelay;\r\n  }\r\n}\r\n","import { getActivator } from \"utils/helper\";\r\n\r\nimport { parseMouseEvent } from \"../events/EventType\";\r\nimport Delayable from \"./delayable\";\r\n\r\ntype Listeners = Record<\r\n  string,\r\n  (e: MouseEvent & KeyboardEvent & FocusEvent) => void\r\n>;\r\n\r\nclass Activatable extends Delayable {\r\n  activator?: HTMLElement;\r\n  popupElement?: HTMLElement;\r\n  disabled: boolean;\r\n  openOnClick: boolean;\r\n  openOnHover: boolean;\r\n  openOnFocus: boolean;\r\n\r\n  closeOnOutsideClick: boolean;\r\n  closeOnContentClick: boolean;\r\n\r\n  activatorListeners: Listeners = {};\r\n  popupListeners: Listeners = {};\r\n\r\n  constructor(\r\n    activatorSelector: string,\r\n    disabled: boolean,\r\n    openOnClick: boolean,\r\n    openOnHover: boolean,\r\n    openOnFocus: boolean,\r\n    openDelay: number,\r\n    closeDelay: number,\r\n    dotNetHelper: DotNet.DotNetObject\r\n  ) {\r\n    super(openDelay, closeDelay, dotNetHelper);\r\n\r\n    this.activator = getActivator(activatorSelector);\r\n\r\n    this.disabled = disabled;\r\n    this.openOnClick = openOnClick;\r\n    this.openOnHover = openOnHover;\r\n    this.openOnFocus = openOnFocus;\r\n    this.dotNetHelper = dotNetHelper;\r\n  }\r\n\r\n  //#region activators\r\n\r\n  resetActivator(selector: string) {\r\n    const activator = document.querySelector(selector);\r\n    if (activator) {\r\n      this.activator = activator as HTMLElement;\r\n    }\r\n\r\n    this.resetActivatorEvents(\r\n      this.disabled,\r\n      this.openOnHover,\r\n      this.openOnFocus\r\n    );\r\n  }\r\n\r\n  addActivatorEvents() {\r\n    if (!this.activator || this.disabled) return;\r\n\r\n    this.activatorListeners = this.genActivatorListeners();\r\n    const keys = Object.keys(this.activatorListeners);\r\n\r\n    for (const key of keys) {\r\n      this.activator.addEventListener(key, this.activatorListeners[key] as any);\r\n    }\r\n  }\r\n\r\n  genActivatorListeners() {\r\n    if (this.disabled) return {};\r\n\r\n    const listeners: Listeners = {};\r\n\r\n    if (this.openOnHover) {\r\n      listeners.mouseenter = (e: MouseEvent) => {\r\n        this.runDelay(\"open\");\r\n      };\r\n      listeners.mouseleave = (e: MouseEvent) => {\r\n        this.runDelay(\"close\");\r\n      };\r\n    } else if (this.openOnClick) {\r\n      listeners.click = (e: MouseEvent) => {\r\n        if (this.activator) this.activator.focus();\r\n\r\n        e.stopPropagation();\r\n\r\n        this.dotNetHelper.invokeMethodAsync(\"OnClick\", parseMouseEvent(e));\r\n\r\n        this.setActive(!this.isActive);\r\n      };\r\n    }\r\n\r\n    if (this.openOnFocus) {\r\n      listeners.focus = (e: FocusEvent) => {\r\n        e.stopPropagation();\r\n\r\n        this.runDelay(\"open\");\r\n      };\r\n\r\n      listeners.blur = (e: FocusEvent) => {\r\n        this.runDelay(\"close\");\r\n      };\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n\r\n  removeActivatorEvents() {\r\n    if (!this.activator) return;\r\n\r\n    const keys = Object.keys(this.activatorListeners);\r\n\r\n    for (const key of keys) {\r\n      this.activator.removeEventListener(key, this.activatorListeners[key]);\r\n    }\r\n\r\n    this.activatorListeners = {};\r\n  }\r\n\r\n  resetActivatorEvents(\r\n    disabled: boolean,\r\n    openOnHover: boolean,\r\n    openOnFocus: boolean\r\n  ) {\r\n    this.disabled = disabled;\r\n    this.openOnHover = openOnHover;\r\n    this.openOnFocus = openOnFocus;\r\n\r\n    this.removeActivatorEvents();\r\n    this.addActivatorEvents();\r\n  }\r\n\r\n  runDelaying(val: boolean) {\r\n    this.runDelay(val ? \"open\" : \"close\");\r\n  }\r\n\r\n  //#endregion\r\n\r\n  //#region popups\r\n\r\n  registerPopup(popupSelector: string, closeOnContentClick: boolean) {\r\n    const popup = document.querySelector(popupSelector);\r\n    if (!popup) {\r\n      console.error(\"popup not exists\");\r\n      return;\r\n    }\r\n\r\n    this.popupElement = popup as HTMLElement;\r\n    this.closeOnContentClick = closeOnContentClick;\r\n\r\n    this.addPopupEvents();\r\n  }\r\n\r\n  addPopupEvents() {\r\n    if (!this.popupElement || this.disabled) return;\r\n\r\n    this.popupListeners = this.genPopupListeners();\r\n    const keys = Object.keys(this.popupListeners);\r\n\r\n    for (const key of keys) {\r\n      this.popupElement.addEventListener(key, this.popupListeners[key] as any);\r\n    }\r\n  }\r\n\r\n  removePopupEvents() {\r\n    if (!this.popupElement) return;\r\n\r\n    const keys = Object.keys(this.popupListeners);\r\n\r\n    for (const key of keys) {\r\n      this.popupElement.removeEventListener(key, this.popupListeners[key]);\r\n    }\r\n\r\n    this.popupListeners = {};\r\n  }\r\n\r\n  genPopupListeners() {\r\n    if (this.disabled) return;\r\n\r\n    const listeners: Listeners = {};\r\n\r\n    if (!this.disabled && this.openOnHover) {\r\n      listeners.mouseenter = (e) => {\r\n        this.runDelay(\"open\");\r\n      };\r\n\r\n      listeners.mouseleave = (e) => {\r\n        this.runDelay(\"close\");\r\n      };\r\n    }\r\n\r\n    if (this.closeOnContentClick) {\r\n      listeners.click = (e) => {\r\n        this.setActive(false);\r\n      };\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n\r\n  resetPopupEvents(closeOnContentClick: boolean) {\r\n    this.closeOnContentClick = closeOnContentClick;\r\n\r\n    this.removePopupEvents();\r\n    this.addPopupEvents();\r\n  }\r\n\r\n  //#endregion\r\n}\r\n\r\nfunction init(\r\n  activatorSelector: string,\r\n  disabled: boolean,\r\n  openOnClick: boolean,\r\n  openOnHover: boolean,\r\n  openOnFocus: boolean,\r\n  openDelay: number,\r\n  closeDelay: number,\r\n  dotNetHelper: DotNet.DotNetObject\r\n) {\r\n  var instance = new Activatable(\r\n    activatorSelector,\r\n    disabled,\r\n    openOnClick,\r\n    openOnHover,\r\n    openOnFocus,\r\n    openDelay,\r\n    closeDelay,\r\n    dotNetHelper\r\n  );\r\n\r\n  instance.addActivatorEvents();\r\n\r\n  return instance;\r\n}\r\n\r\nexport { init };\r\n"],"names":[],"mappings":";;;AAAc,MAAO,SAAS,CAAA;AAS5B,IAAA,WAAA,CACE,SAAiB,EACjB,UAAkB,EAClB,YAAiC,EAAA;AAEjC,QAAA,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;AAC3B,QAAA,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;AAC7B,QAAA,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;KAClC;IAED,UAAU,GAAA;AACR,QAAA,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AAC/B,QAAA,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;KACjC;IAED,QAAQ,CAAC,IAAsB,EAAE,EAAe,EAAA;QAC9C,IAAI,CAAC,UAAU,EAAE,CAAC;AAElB,QAAA,MAAM,KAAK,GAAG,QAAQ,CAAE,IAAY,CAAC,CAAG,EAAA,IAAI,CAAO,KAAA,CAAA,CAAC,EAAE,EAAE,CAAC,CAAC;QAEzD,IAAY,CAAC,GAAG,IAAI,CAAA,OAAA,CAAS,CAAC,GAAG,UAAU,CAC1C,EAAE;AACA,aAAC,MAAK;AACJ,gBAAA,MAAM,QAAQ,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC;AACpD,gBAAA,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;AAC3B,aAAC,CAAC,EACJ,KAAK,CACN,CAAC;KACH;AAED,IAAA,SAAS,CAAC,MAAe,EAAA;AACvB,QAAA,IAAI,IAAI,CAAC,QAAQ,IAAI,MAAM,EAAE;YAC3B,OAAO;AACR,SAAA;AAED,QAAA,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;QACvB,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;KACjE;IAED,UAAU,CAAC,SAAiB,EAAE,UAAkB,EAAA;AAC9C,QAAA,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;AAC3B,QAAA,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;KAC9B;AACF;;AC1CD,MAAM,WAAY,SAAQ,SAAS,CAAA;AAcjC,IAAA,WAAA,CACE,iBAAyB,EACzB,QAAiB,EACjB,WAAoB,EACpB,WAAoB,EACpB,WAAoB,EACpB,SAAiB,EACjB,UAAkB,EAClB,YAAiC,EAAA;AAEjC,QAAA,KAAK,CAAC,SAAS,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC;QAb7C,IAAkB,CAAA,kBAAA,GAAc,EAAE,CAAC;QACnC,IAAc,CAAA,cAAA,GAAc,EAAE,CAAC;AAc7B,QAAA,IAAI,CAAC,SAAS,GAAG,YAAY,CAAC,iBAAiB,CAAC,CAAC;AAEjD,QAAA,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;AACzB,QAAA,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;AAC/B,QAAA,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;AAC/B,QAAA,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;AAC/B,QAAA,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;KAClC;;AAID,IAAA,cAAc,CAAC,QAAgB,EAAA;QAC7B,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AACnD,QAAA,IAAI,SAAS,EAAE;AACb,YAAA,IAAI,CAAC,SAAS,GAAG,SAAwB,CAAC;AAC3C,SAAA;AAED,QAAA,IAAI,CAAC,oBAAoB,CACvB,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,WAAW,CACjB,CAAC;KACH;IAED,kBAAkB,GAAA;AAChB,QAAA,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO;AAE7C,QAAA,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QACvD,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AAElD,QAAA,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;AACtB,YAAA,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,GAAG,EAAE,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAQ,CAAC,CAAC;AAC3E,SAAA;KACF;IAED,qBAAqB,GAAA;QACnB,IAAI,IAAI,CAAC,QAAQ;AAAE,YAAA,OAAO,EAAE,CAAC;QAE7B,MAAM,SAAS,GAAc,EAAE,CAAC;QAEhC,IAAI,IAAI,CAAC,WAAW,EAAE;AACpB,YAAA,SAAS,CAAC,UAAU,GAAG,CAAC,CAAa,KAAI;AACvC,gBAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AACxB,aAAC,CAAC;AACF,YAAA,SAAS,CAAC,UAAU,GAAG,CAAC,CAAa,KAAI;AACvC,gBAAA,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACzB,aAAC,CAAC;AACH,SAAA;aAAM,IAAI,IAAI,CAAC,WAAW,EAAE;AAC3B,YAAA,SAAS,CAAC,KAAK,GAAG,CAAC,CAAa,KAAI;gBAClC,IAAI,IAAI,CAAC,SAAS;AAAE,oBAAA,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;gBAE3C,CAAC,CAAC,eAAe,EAAE,CAAC;AAEpB,gBAAA,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEnE,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACjC,aAAC,CAAC;AACH,SAAA;QAED,IAAI,IAAI,CAAC,WAAW,EAAE;AACpB,YAAA,SAAS,CAAC,KAAK,GAAG,CAAC,CAAa,KAAI;gBAClC,CAAC,CAAC,eAAe,EAAE,CAAC;AAEpB,gBAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AACxB,aAAC,CAAC;AAEF,YAAA,SAAS,CAAC,IAAI,GAAG,CAAC,CAAa,KAAI;AACjC,gBAAA,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACzB,aAAC,CAAC;AACH,SAAA;AAED,QAAA,OAAO,SAAS,CAAC;KAClB;IAED,qBAAqB,GAAA;QACnB,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,OAAO;QAE5B,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AAElD,QAAA,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;AACtB,YAAA,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,GAAG,EAAE,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC;AACvE,SAAA;AAED,QAAA,IAAI,CAAC,kBAAkB,GAAG,EAAE,CAAC;KAC9B;AAED,IAAA,oBAAoB,CAClB,QAAiB,EACjB,WAAoB,EACpB,WAAoB,EAAA;AAEpB,QAAA,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;AACzB,QAAA,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;AAC/B,QAAA,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAE/B,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC7B,IAAI,CAAC,kBAAkB,EAAE,CAAC;KAC3B;AAED,IAAA,WAAW,CAAC,GAAY,EAAA;AACtB,QAAA,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,MAAM,GAAG,OAAO,CAAC,CAAC;KACvC;;;IAMD,aAAa,CAAC,aAAqB,EAAE,mBAA4B,EAAA;QAC/D,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;QACpD,IAAI,CAAC,KAAK,EAAE;AACV,YAAA,OAAO,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC;YAClC,OAAO;AACR,SAAA;AAED,QAAA,IAAI,CAAC,YAAY,GAAG,KAAoB,CAAC;AACzC,QAAA,IAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;QAE/C,IAAI,CAAC,cAAc,EAAE,CAAC;KACvB;IAED,cAAc,GAAA;AACZ,QAAA,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO;AAEhD,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC/C,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AAE9C,QAAA,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;AACtB,YAAA,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAQ,CAAC,CAAC;AAC1E,SAAA;KACF;IAED,iBAAiB,GAAA;QACf,IAAI,CAAC,IAAI,CAAC,YAAY;YAAE,OAAO;QAE/B,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AAE9C,QAAA,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;AACtB,YAAA,IAAI,CAAC,YAAY,CAAC,mBAAmB,CAAC,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC;AACtE,SAAA;AAED,QAAA,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;KAC1B;IAED,iBAAiB,GAAA;QACf,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO;QAE1B,MAAM,SAAS,GAAc,EAAE,CAAC;QAEhC,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,WAAW,EAAE;AACtC,YAAA,SAAS,CAAC,UAAU,GAAG,CAAC,CAAC,KAAI;AAC3B,gBAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AACxB,aAAC,CAAC;AAEF,YAAA,SAAS,CAAC,UAAU,GAAG,CAAC,CAAC,KAAI;AAC3B,gBAAA,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACzB,aAAC,CAAC;AACH,SAAA;QAED,IAAI,IAAI,CAAC,mBAAmB,EAAE;AAC5B,YAAA,SAAS,CAAC,KAAK,GAAG,CAAC,CAAC,KAAI;AACtB,gBAAA,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AACxB,aAAC,CAAC;AACH,SAAA;AAED,QAAA,OAAO,SAAS,CAAC;KAClB;AAED,IAAA,gBAAgB,CAAC,mBAA4B,EAAA;AAC3C,QAAA,IAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;QAE/C,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,cAAc,EAAE,CAAC;KACvB;AAGF,CAAA;AAED,SAAS,IAAI,CACX,iBAAyB,EACzB,QAAiB,EACjB,WAAoB,EACpB,WAAoB,EACpB,WAAoB,EACpB,SAAiB,EACjB,UAAkB,EAClB,YAAiC,EAAA;IAEjC,IAAI,QAAQ,GAAG,IAAI,WAAW,CAC5B,iBAAiB,EACjB,QAAQ,EACR,WAAW,EACX,WAAW,EACX,WAAW,EACX,SAAS,EACT,UAAU,EACV,YAAY,CACb,CAAC;IAEF,QAAQ,CAAC,kBAAkB,EAAE,CAAC;AAE9B,IAAA,OAAO,QAAQ,CAAC;AAClB;;;;"}