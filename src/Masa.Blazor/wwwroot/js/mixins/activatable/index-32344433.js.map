{"version":3,"file":"index-32344433.js","sources":["../../../../../Masa.Blazor.JS/src/mixins/delayable.ts","../../../../../Masa.Blazor.JS/src/mixins/activatable.ts"],"sourcesContent":["export default class Delayable {\r\n  openDelay: number;\r\n  closeDelay: number;\r\n  dotNetHelper: DotNet.DotNetObject;\r\n\r\n  openTimeout;\r\n  closeTimeout;\r\n  isActive: boolean;\r\n\r\n  constructor(\r\n    openDelay: number,\r\n    closeDelay: number,\r\n    dotNetHelper: DotNet.DotNetObject\r\n  ) {\r\n    this.openDelay = openDelay;\r\n    this.closeDelay = closeDelay;\r\n    this.dotNetHelper = dotNetHelper;\r\n  }\r\n\r\n  clearDelay() {\r\n    clearTimeout(this.openTimeout);\r\n    clearTimeout(this.closeTimeout);\r\n  }\r\n\r\n  runDelay(type: \"open\" | \"close\", cb?: () => void) {\r\n    this.clearDelay();\r\n\r\n    const delay = parseInt((this as any)[`${type}Delay`], 10);\r\n\r\n    (this as any)[`${type}Timeout`] = setTimeout(\r\n      cb ||\r\n        (() => {\r\n          const isActive = { open: true, close: false }[type];\r\n          this.setActive(isActive);\r\n        }),\r\n      delay\r\n    );\r\n  }\r\n\r\n  setActive(active: boolean) {\r\n    if (this.isActive == active) {\r\n      return;\r\n    }\r\n\r\n    this.isActive = active;\r\n    this.dotNetHelper.invokeMethodAsync(\"SetActive\", this.isActive);\r\n  }\r\n\r\n  resetDelay(openDelay: number, closeDelay: number) {\r\n    this.openDelay = openDelay;\r\n    this.closeDelay = closeDelay;\r\n  }\r\n}\r\n","import { getActivator } from \"utils/helper\";\r\n\r\nimport { parseMouseEvent } from \"../events/EventType\";\r\nimport Delayable from \"./delayable\";\r\n\r\ntype Listeners = Record<\r\n  string,\r\n  (e: MouseEvent & KeyboardEvent & FocusEvent) => void\r\n>;\r\n\r\nclass Activatable extends Delayable {\r\n  activator?: HTMLElement;\r\n  popupElement?: HTMLElement;\r\n  disabled: boolean;\r\n  openOnClick: boolean;\r\n  openOnHover: boolean;\r\n  openOnFocus: boolean;\r\n  toggleOnClick: boolean;\r\n\r\n  closeOnOutsideClick: boolean;\r\n  closeOnContentClick: boolean;\r\n\r\n  activatorListeners: Listeners = {};\r\n  popupListeners: Listeners = {};\r\n\r\n  constructor(\r\n    isActive: boolean,\r\n    activatorSelector: string,\r\n    disabled: boolean,\r\n    openOnClick: boolean,\r\n    openOnHover: boolean,\r\n    openOnFocus: boolean,\r\n    openDelay: number,\r\n    closeDelay: number,\r\n    dotNetHelper: DotNet.DotNetObject,\r\n    toggleOnClick: boolean\r\n  ) {\r\n    super(openDelay, closeDelay, dotNetHelper);\r\n\r\n    this.isActive = isActive;\r\n\r\n    this.activator = getActivator(activatorSelector);\r\n\r\n    this.disabled = disabled;\r\n    this.openOnClick = openOnClick;\r\n    this.openOnHover = openOnHover;\r\n    this.openOnFocus = openOnFocus;\r\n    this.toggleOnClick = toggleOnClick;\r\n    this.dotNetHelper = dotNetHelper;\r\n  }\r\n\r\n  //#region activators\r\n\r\n  resetActivator(selector: string) {\r\n    const activator = document.querySelector(selector);\r\n    if (activator) {\r\n      this.activator = activator as HTMLElement;\r\n    }\r\n\r\n    this.resetActivatorEvents(\r\n      this.disabled,\r\n      this.openOnHover,\r\n      this.openOnFocus\r\n    );\r\n  }\r\n\r\n  addActivatorEvents() {\r\n    if (!this.activator || this.disabled) return;\r\n\r\n    this.activatorListeners = this.genActivatorListeners();\r\n    const keys = Object.keys(this.activatorListeners);\r\n\r\n    for (const key of keys) {\r\n      this.activator.addEventListener(key, this.activatorListeners[key] as any);\r\n    }\r\n  }\r\n\r\n  genActivatorListeners() {\r\n    if (this.disabled) return {};\r\n\r\n    const listeners: Listeners = {};\r\n\r\n    if (this.openOnHover) {\r\n      listeners.mouseenter = (e: MouseEvent) => {\r\n        this.runDelay(\"open\");\r\n      };\r\n      listeners.mouseleave = (e: MouseEvent) => {\r\n        this.runDelay(\"close\");\r\n      };\r\n    } else if (this.openOnClick) {\r\n      listeners.click = (e: MouseEvent) => {\r\n        if (this.activator) this.activator.focus();\r\n\r\n        // if there is no click event from blazor on the element, stop propagation\r\n        const target = e.composedPath().find(e => e === this.activator)\r\n        if (!target?._blazorEvents_1?.handlers?.click) {\r\n          e.stopPropagation();\r\n        }\r\n\r\n        this.dotNetHelper.invokeMethodAsync(\"OnClick\", parseMouseEvent(e));\r\n\r\n        if (this.toggleOnClick || !this.isActive) {\r\n          this.setActive(!this.isActive);\r\n        }\r\n      };\r\n    }\r\n\r\n    if (this.openOnFocus) {\r\n      listeners.focus = (e: FocusEvent) => {\r\n        // if there is no focus event from blazor on the element, stop propagation\r\n        const target = e.composedPath().find(e => e === this.activator)\r\n        if (!target?._blazorEvents_1?.handlers?.focus) {\r\n          e.stopPropagation();\r\n        }\r\n\r\n        this.runDelay(\"open\");\r\n      };\r\n\r\n      listeners.blur = (e: FocusEvent) => {\r\n        this.runDelay(\"close\");\r\n      };\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n\r\n  removeActivatorEvents() {\r\n    if (!this.activator) return;\r\n\r\n    const keys = Object.keys(this.activatorListeners);\r\n\r\n    for (const key of keys) {\r\n      this.activator.removeEventListener(key, this.activatorListeners[key]);\r\n    }\r\n\r\n    this.activatorListeners = {};\r\n  }\r\n\r\n  resetActivatorEvents(\r\n    disabled: boolean,\r\n    openOnHover: boolean,\r\n    openOnFocus: boolean\r\n  ) {\r\n    this.disabled = disabled;\r\n    this.openOnHover = openOnHover;\r\n    this.openOnFocus = openOnFocus;\r\n\r\n    this.removeActivatorEvents();\r\n    this.addActivatorEvents();\r\n  }\r\n\r\n  runDelaying(val: boolean) {\r\n    this.runDelay(val ? \"open\" : \"close\");\r\n  }\r\n\r\n  //#endregion\r\n\r\n  //#region popups\r\n\r\n  registerPopup(popupSelector: string, closeOnContentClick: boolean) {\r\n    const popup = document.querySelector(popupSelector);\r\n    if (!popup) {\r\n      console.error(\"popup not exists\");\r\n      return;\r\n    }\r\n\r\n    this.popupElement = popup as HTMLElement;\r\n    this.closeOnContentClick = closeOnContentClick;\r\n\r\n    this.addPopupEvents();\r\n  }\r\n\r\n  addPopupEvents() {\r\n    if (!this.popupElement || this.disabled) return;\r\n\r\n    this.popupListeners = this.genPopupListeners();\r\n    const keys = Object.keys(this.popupListeners);\r\n\r\n    for (const key of keys) {\r\n      this.popupElement.addEventListener(key, this.popupListeners[key] as any);\r\n    }\r\n  }\r\n\r\n  removePopupEvents() {\r\n    if (!this.popupElement) return;\r\n\r\n    const keys = Object.keys(this.popupListeners);\r\n\r\n    for (const key of keys) {\r\n      this.popupElement.removeEventListener(key, this.popupListeners[key]);\r\n    }\r\n\r\n    this.popupListeners = {};\r\n  }\r\n\r\n  genPopupListeners() {\r\n    if (this.disabled) return;\r\n\r\n    const listeners: Listeners = {};\r\n\r\n    if (!this.disabled && this.openOnHover) {\r\n      listeners.mouseenter = (e) => {\r\n        this.runDelay(\"open\");\r\n      };\r\n\r\n      listeners.mouseleave = (e) => {\r\n        this.runDelay(\"close\");\r\n      };\r\n    }\r\n\r\n    if (this.closeOnContentClick) {\r\n      listeners.click = (e) => {\r\n        this.setActive(false);\r\n      };\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n\r\n  resetPopupEvents(closeOnContentClick: boolean) {\r\n    this.closeOnContentClick = closeOnContentClick;\r\n\r\n    this.removePopupEvents();\r\n    this.addPopupEvents();\r\n  }\r\n\r\n  //#endregion\r\n}\r\n\r\nfunction init(\r\n  isActive: boolean,\r\n  activatorSelector: string,\r\n  disabled: boolean,\r\n  openOnClick: boolean,\r\n  openOnHover: boolean,\r\n  openOnFocus: boolean,\r\n  openDelay: number,\r\n  closeDelay: number,\r\n  dotNetHelper: DotNet.DotNetObject,\r\n  toggleOnClick: boolean = true\r\n) {\r\n  var instance = new Activatable(\r\n    isActive,\r\n    activatorSelector,\r\n    disabled,\r\n    openOnClick,\r\n    openOnHover,\r\n    openOnFocus,\r\n    openDelay,\r\n    closeDelay,\r\n    dotNetHelper,\r\n    toggleOnClick\r\n  );\r\n\r\n  instance.addActivatorEvents();\r\n\r\n  return instance;\r\n}\r\n\r\nexport { init };\r\n"],"names":["Delayable","constructor","openDelay","closeDelay","dotNetHelper","this","clearDelay","clearTimeout","openTimeout","closeTimeout","runDelay","type","cb","delay","parseInt","setTimeout","isActive","open","close","setActive","active","invokeMethodAsync","resetDelay","Activatable","activatorSelector","disabled","openOnClick","openOnHover","openOnFocus","toggleOnClick","super","activatorListeners","popupListeners","activator","getActivator","resetActivator","selector","document","querySelector","resetActivatorEvents","addActivatorEvents","genActivatorListeners","keys","Object","key","addEventListener","listeners","mouseenter","e","mouseleave","click","focus","target","composedPath","find","_b","_a","_blazorEvents_1","handlers","stopPropagation","parseMouseEvent","blur","removeActivatorEvents","removeEventListener","runDelaying","val","registerPopup","popupSelector","closeOnContentClick","popup","popupElement","addPopupEvents","console","error","genPopupListeners","removePopupEvents","resetPopupEvents","init","instance"],"mappings":"2GAAc,MAAOA,EASnB,WAAAC,CACEC,EACAC,EACAC,GAEAC,KAAKH,UAAYA,EACjBG,KAAKF,WAAaA,EAClBE,KAAKD,aAAeA,CACrB,CAED,UAAAE,GACEC,aAAaF,KAAKG,aAClBD,aAAaF,KAAKI,aACnB,CAED,QAAAC,CAASC,EAAwBC,GAC/BP,KAAKC,aAEL,MAAMO,EAAQC,SAAUT,KAAa,GAAGM,UAAc,IAErDN,KAAa,GAAGM,YAAiBI,WAChCH,GACE,MACE,MAAMI,EAAW,CAAEC,MAAM,EAAMC,OAAO,GAAQP,GAC9CN,KAAKc,UAAUH,EAChB,GACHH,EAEH,CAED,SAAAM,CAAUC,GACJf,KAAKW,UAAYI,IAIrBf,KAAKW,SAAWI,EAChBf,KAAKD,aAAaiB,kBAAkB,YAAahB,KAAKW,UACvD,CAED,UAAAM,CAAWpB,EAAmBC,GAC5BE,KAAKH,UAAYA,EACjBG,KAAKF,WAAaA,CACnB,ECzCH,MAAMoB,UAAoBvB,EAexB,WAAAC,CACEe,EACAQ,EACAC,EACAC,EACAC,EACAC,EACA1B,EACAC,EACAC,EACAyB,GAEAC,MAAM5B,EAAWC,EAAYC,GAf/BC,KAAkB0B,mBAAc,GAChC1B,KAAc2B,eAAc,GAgB1B3B,KAAKW,SAAWA,EAEhBX,KAAK4B,UAAYC,EAAaV,GAE9BnB,KAAKoB,SAAWA,EAChBpB,KAAKqB,YAAcA,EACnBrB,KAAKsB,YAAcA,EACnBtB,KAAKuB,YAAcA,EACnBvB,KAAKwB,cAAgBA,EACrBxB,KAAKD,aAAeA,CACrB,CAID,cAAA+B,CAAeC,GACb,MAAMH,EAAYI,SAASC,cAAcF,GACrCH,IACF5B,KAAK4B,UAAYA,GAGnB5B,KAAKkC,qBACHlC,KAAKoB,SACLpB,KAAKsB,YACLtB,KAAKuB,YAER,CAED,kBAAAY,GACE,IAAKnC,KAAK4B,WAAa5B,KAAKoB,SAAU,OAEtCpB,KAAK0B,mBAAqB1B,KAAKoC,wBAC/B,MAAMC,EAAOC,OAAOD,KAAKrC,KAAK0B,oBAE9B,IAAK,MAAMa,KAAOF,EAChBrC,KAAK4B,UAAUY,iBAAiBD,EAAKvC,KAAK0B,mBAAmBa,GAEhE,CAED,qBAAAH,GACE,GAAIpC,KAAKoB,SAAU,MAAO,GAE1B,MAAMqB,EAAuB,CAAA,EA2C7B,OAzCIzC,KAAKsB,aACPmB,EAAUC,WAAcC,IACtB3C,KAAKK,SAAS,SAEhBoC,EAAUG,WAAcD,IACtB3C,KAAKK,SAAS,WAEPL,KAAKqB,cACdoB,EAAUI,MAASF,YACb3C,KAAK4B,WAAW5B,KAAK4B,UAAUkB,QAGnC,MAAMC,EAASJ,EAAEK,eAAeC,KAAKN,GAAKA,IAAM3C,KAAK4B,YACb,QAAnCsB,EAAyB,QAAzBC,EAAAJ,aAAM,EAANA,EAAQK,uBAAiB,IAAAD,OAAA,EAAAA,EAAAE,gBAAU,IAAAH,OAAA,EAAAA,EAAAL,QACtCF,EAAEW,kBAGJtD,KAAKD,aAAaiB,kBAAkB,UAAWuC,EAAgBZ,KAE3D3C,KAAKwB,eAAkBxB,KAAKW,UAC9BX,KAAKc,WAAWd,KAAKW,YAKvBX,KAAKuB,cACPkB,EAAUK,MAASH,YAEjB,MAAMI,EAASJ,EAAEK,eAAeC,KAAKN,GAAKA,IAAM3C,KAAK4B,YACb,QAAnCsB,EAAyB,QAAzBC,EAAAJ,aAAM,EAANA,EAAQK,uBAAiB,IAAAD,OAAA,EAAAA,EAAAE,gBAAU,IAAAH,OAAA,EAAAA,EAAAJ,QACtCH,EAAEW,kBAGJtD,KAAKK,SAAS,SAGhBoC,EAAUe,KAAQb,IAChB3C,KAAKK,SAAS,WAIXoC,CACR,CAED,qBAAAgB,GACE,IAAKzD,KAAK4B,UAAW,OAErB,MAAMS,EAAOC,OAAOD,KAAKrC,KAAK0B,oBAE9B,IAAK,MAAMa,KAAOF,EAChBrC,KAAK4B,UAAU8B,oBAAoBnB,EAAKvC,KAAK0B,mBAAmBa,IAGlEvC,KAAK0B,mBAAqB,EAC3B,CAED,oBAAAQ,CACEd,EACAE,EACAC,GAEAvB,KAAKoB,SAAWA,EAChBpB,KAAKsB,YAAcA,EACnBtB,KAAKuB,YAAcA,EAEnBvB,KAAKyD,wBACLzD,KAAKmC,oBACN,CAED,WAAAwB,CAAYC,GACV5D,KAAKK,SAASuD,EAAM,OAAS,QAC9B,CAMD,aAAAC,CAAcC,EAAuBC,GACnC,MAAMC,EAAQhC,SAASC,cAAc6B,GAChCE,GAKLhE,KAAKiE,aAAeD,EACpBhE,KAAK+D,oBAAsBA,EAE3B/D,KAAKkE,kBAPHC,QAAQC,MAAM,mBAQjB,CAED,cAAAF,GACE,IAAKlE,KAAKiE,cAAgBjE,KAAKoB,SAAU,OAEzCpB,KAAK2B,eAAiB3B,KAAKqE,oBAC3B,MAAMhC,EAAOC,OAAOD,KAAKrC,KAAK2B,gBAE9B,IAAK,MAAMY,KAAOF,EAChBrC,KAAKiE,aAAazB,iBAAiBD,EAAKvC,KAAK2B,eAAeY,GAE/D,CAED,iBAAA+B,GACE,IAAKtE,KAAKiE,aAAc,OAExB,MAAM5B,EAAOC,OAAOD,KAAKrC,KAAK2B,gBAE9B,IAAK,MAAMY,KAAOF,EAChBrC,KAAKiE,aAAaP,oBAAoBnB,EAAKvC,KAAK2B,eAAeY,IAGjEvC,KAAK2B,eAAiB,EACvB,CAED,iBAAA0C,GACE,GAAIrE,KAAKoB,SAAU,OAEnB,MAAMqB,EAAuB,CAAA,EAkB7B,OAhBKzC,KAAKoB,UAAYpB,KAAKsB,cACzBmB,EAAUC,WAAcC,IACtB3C,KAAKK,SAAS,SAGhBoC,EAAUG,WAAcD,IACtB3C,KAAKK,SAAS,WAIdL,KAAK+D,sBACPtB,EAAUI,MAASF,IACjB3C,KAAKc,WAAU,KAIZ2B,CACR,CAED,gBAAA8B,CAAiBR,GACf/D,KAAK+D,oBAAsBA,EAE3B/D,KAAKsE,oBACLtE,KAAKkE,gBACN,EAKH,SAASM,EACP7D,EACAQ,EACAC,EACAC,EACAC,EACAC,EACA1B,EACAC,EACAC,EACAyB,GAAyB,GAEzB,IAAIiD,EAAW,IAAIvD,EACjBP,EACAQ,EACAC,EACAC,EACAC,EACAC,EACA1B,EACAC,EACAC,EACAyB,GAKF,OAFAiD,EAAStC,qBAEFsC,CACT"}