{"version":3,"file":"index.js","sources":["../../../../../Masa.Blazor.JS/src/mixins/intersect.ts"],"sourcesContent":["import { getEventTarget } from \"utils/helper\";\r\n\r\nexport interface IntersectionObserverOptions {\r\n  rootSelector?: string;\r\n  rootMarginLeft?: string;\r\n  rootMarginRight?: string;\r\n  rootMarginTop?: string;\r\n  rootMarginBottom?: string;\r\n  autoRootMargin: \"None\" | \"Top\" | \"Right\" | \"Bottom\" | \"Left\";\r\n  threshold: number[];\r\n  once: boolean;\r\n}\r\n\r\nfunction observe(\r\n  el: HTMLElement,\r\n  handle: DotNet.DotNetObject,\r\n  options?: IntersectionObserverOptions\r\n) {\r\n  if (!handle) {\r\n    throw new Error(\"the handle cannot be null\");\r\n  }\r\n\r\n  if (!el) {\r\n    handle.dispose();\r\n    return;\r\n  }\r\n\r\n  if (el[\"_intersect\"]) {\r\n    return;\r\n  }\r\n\r\n  const once = options?.once ?? false;\r\n\r\n  const standardOptions = formatToStandardOptions(options);\r\n\r\n  const observer = new IntersectionObserver(\r\n    async (\r\n      entries: IntersectionObserverEntry[] = [],\r\n      observer: IntersectionObserver\r\n    ) => {\r\n\r\n      const computedEntries = entries.map((entry) => ({\r\n        isIntersecting: entry.isIntersecting,\r\n        target: getEventTarget(entry.target),\r\n      }));\r\n\r\n      const isIntersecting = computedEntries.some((e) => e.isIntersecting);\r\n\r\n      if (!once || isIntersecting) {\r\n        await handle.invokeMethodAsync(\"Invoke\", {\r\n          isIntersecting,\r\n          entries: computedEntries,\r\n        });\r\n      }\r\n\r\n      if (isIntersecting && once) {\r\n        unobserve(el);\r\n      }\r\n    },\r\n    standardOptions\r\n  );\r\n\r\n  el[\"_intersect\"] = Object(el[\"_intersect\"]);\r\n  el[\"_intersect\"] = { handle, observer };\r\n\r\n  observer.observe(el);\r\n}\r\n\r\nfunction unobserve(el: HTMLElement) {\r\n  if (!el) return;\r\n\r\n  const observe = el[\"_intersect\"];\r\n  if (!observe) return;\r\n\r\n  observe.observer.unobserve(el);\r\n  observe.handle.dispose();\r\n  delete el[\"_intersect\"];\r\n}\r\n\r\nfunction observeSelector(\r\n  selector: string,\r\n  handle: DotNet.DotNetObject,\r\n  options?: IntersectionObserverOptions\r\n) {\r\n\r\n  if (selector) {\r\n    const el = document.querySelector(selector) as HTMLElement;\r\n    el && observe(el, handle, options);\r\n  }\r\n}\r\n\r\nfunction unobserveSelector(selector: string) {\r\n  if (selector) {\r\n    const el = document.querySelector(selector) as HTMLElement;\r\n    el && unobserve(el);\r\n  }\r\n}\r\n\r\nexport function formatToStandardOptions(\r\n  options?: IntersectionObserverOptions\r\n): IntersectionObserverInit | null {\r\n  if (!options) {\r\n    return null;\r\n  }\r\n\r\n  const root: HTMLLIElement = options.rootSelector\r\n    ? document.querySelector(options.rootSelector)\r\n    : null;\r\n\r\n  if (options.autoRootMargin !== \"None\") {\r\n    if (\r\n      options.autoRootMargin === \"Top\" &&\r\n      options.rootMarginBottom !== \"0px\"\r\n    ) {\r\n      options.rootMarginTop =\r\n        calcAuto(root, options.rootMarginBottom, false) + \"px\";\r\n    } else if (\r\n      options.autoRootMargin === \"Right\" &&\r\n      options.rootMarginLeft !== \"0px\"\r\n    ) {\r\n      options.rootMarginRight =\r\n        calcAuto(root, options.rootMarginLeft, false) + \"px\";\r\n    } else if (\r\n      options.autoRootMargin === \"Bottom\" &&\r\n      options.rootMarginTop !== \"0px\"\r\n    ) {\r\n      options.rootMarginBottom =\r\n        calcAuto(root, options.rootMarginTop, false) + \"px\";\r\n    } else if (\r\n      options.autoRootMargin === \"Left\" &&\r\n      options.rootMarginRight !== \"0px\"\r\n    ) {\r\n      options.rootMarginLeft =\r\n        calcAuto(root, options.rootMarginRight, false) + \"px\";\r\n    }\r\n  }\r\n\r\n  return {\r\n    rootMargin: `${options.rootMarginTop} ${options.rootMarginRight} ${options.rootMarginBottom} ${options.rootMarginLeft}`,\r\n    root,\r\n    threshold: options.threshold,\r\n  };\r\n}\r\n\r\nfunction calcAuto(container: HTMLElement, margin: string, x: boolean) {\r\n  container = container || document.documentElement;\r\n  const marginValue = parseInt(margin);\r\n  if (isNaN(marginValue)) {\r\n    return 0;\r\n  }\r\n\r\n  var clientValue = x ? container.clientWidth : container.clientHeight;\r\n\r\n  return Math.abs(marginValue) - clientValue;\r\n}\r\n\r\nexport { observe, unobserve, observeSelector, unobserveSelector };\r\n"],"names":[],"mappings":"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"}