{"version":3,"file":"index-07722781.js","sources":["../../../../../Masa.Blazor.JS/src/mixins/long-press.ts"],"sourcesContent":["import { getDom } from \"utils/helper\";\n\n// 存储长按事件监听器的配置\nconst longPressEventConfigs: Map<\n  HTMLElement,\n  {\n    mousedownHandler: (e: MouseEvent) => void;\n    touchstartHandler: (e: TouchEvent) => void;\n  }\n> = new Map();\n\nexport function register(s: HTMLElement | string, dotnet: DotNet.DotNetObject) {\n  const container = getDom(s);\n  if (!container) {\n    return null;\n  }\n\n  // 如果已经注册过，先注销\n  if (longPressEventConfigs.has(container)) {\n    unregisterLongPressEvent(container);\n  }\n\n  // 使用事件委托来处理长按事件\n  const createLongPressHandler = (eventType: \"mouse\" | \"touch\") => {\n    return function (e: MouseEvent | TouchEvent) {\n      // 阻止默认行为，特别是触摸事件的默认行为\n      if (eventType === \"touch\") {\n        e.preventDefault();\n      }\n\n      const element = e.target as HTMLElement;\n\n      let timer: ReturnType<typeof setTimeout>;\n      const longPressDelay = 500; // 长按阈值（毫秒）\n      let isPressed = true;\n      let startX =\n        e instanceof MouseEvent\n          ? e.clientX\n          : (e as TouchEvent).touches?.[0]?.clientX || 0;\n      let startY =\n        e instanceof MouseEvent\n          ? e.clientY\n          : (e as TouchEvent).touches?.[0]?.clientY || 0;\n\n      timer = setTimeout(() => {\n        if (isPressed) {\n          dotnet.invokeMethodAsync(\"Invoke\");\n        }\n      }, longPressDelay);\n\n      const checkMovement = function (moveEvent: MouseEvent | TouchEvent) {\n        if (!isPressed) return;\n\n        const moveX =\n          moveEvent instanceof MouseEvent\n            ? moveEvent.clientX\n            : (moveEvent as TouchEvent).touches?.[0]?.clientX || 0;\n        const moveY =\n          moveEvent instanceof MouseEvent\n            ? moveEvent.clientY\n            : (moveEvent as TouchEvent).touches?.[0]?.clientY || 0;\n\n        const moveThreshold = 10; // 移动阈值（像素）\n        if (\n          Math.abs(moveX - startX) > moveThreshold ||\n          Math.abs(moveY - startY) > moveThreshold\n        ) {\n          cancelPress();\n        }\n      };\n\n      const cancelPress = function (event?: MouseEvent | TouchEvent) {\n        isPressed = false;\n        clearTimeout(timer);\n\n        // 清理所有监听器\n        if (eventType === \"mouse\") {\n          document.removeEventListener(\"mouseup\", cancelPress);\n          document.removeEventListener(\"mousemove\", checkMovement);\n        } else {\n          document.removeEventListener(\"touchend\", cancelPress);\n          document.removeEventListener(\"touchcancel\", cancelPress);\n          document.removeEventListener(\"touchmove\", checkMovement);\n        }\n        element.removeEventListener(\"mouseleave\", cancelPress);\n      };\n\n      // 添加监听器\n      element.addEventListener(\"mouseleave\", cancelPress, { once: true });\n\n      if (eventType === \"mouse\") {\n        document.addEventListener(\"mouseup\", cancelPress, { once: true });\n        document.addEventListener(\"mousemove\", checkMovement, {\n          passive: false,\n        });\n      } else {\n        document.addEventListener(\"touchend\", cancelPress, {\n          once: true,\n          passive: false,\n        });\n        document.addEventListener(\"touchcancel\", cancelPress, {\n          once: true,\n          passive: false,\n        });\n        document.addEventListener(\"touchmove\", checkMovement, {\n          passive: false,\n        });\n      }\n    };\n  };\n\n  const mousedownHandler = createLongPressHandler(\"mouse\");\n  const touchstartHandler = createLongPressHandler(\"touch\");\n\n  // 添加事件监听器\n  container.addEventListener(\"mousedown\", mousedownHandler, { passive: false });\n  container.addEventListener(\"touchstart\", touchstartHandler, {\n    passive: false,\n  });\n\n  // 保存监听器引用\n  longPressEventConfigs.set(container, {\n    mousedownHandler,\n    touchstartHandler,\n  });\n\n  return {\n    dispose: () => {\n      unregisterLongPressEvent(container);\n      dotnet.dispose();\n    },\n  };\n}\n\nfunction unregisterLongPressEvent(container: HTMLElement) {\n  const config = longPressEventConfigs.get(container);\n  if (config) {\n    // 移除事件监听器\n    container.removeEventListener(\"mousedown\", config.mousedownHandler);\n    container.removeEventListener(\"touchstart\", config.touchstartHandler);\n\n    // 从配置中删除\n    longPressEventConfigs.delete(container);\n  }\n}\n"],"names":["longPressEventConfigs","Map","register","s","dotnet","container","getDom","has","unregisterLongPressEvent","createLongPressHandler","eventType","e","preventDefault","element","target","timer","isPressed","startX","MouseEvent","clientX","_b","_a","touches","startY","clientY","_d","_c","setTimeout","invokeMethodAsync","checkMovement","moveEvent","moveX","moveY","Math","abs","cancelPress","event","clearTimeout","document","removeEventListener","addEventListener","once","passive","mousedownHandler","touchstartHandler","set","dispose","config","get","delete"],"mappings":"oDAGA,MAAMA,EAMF,IAAIC,IAEQ,SAAAC,EAASC,EAAyBC,GAChD,MAAMC,EAAYC,EAAOH,GACzB,IAAKE,EACH,OAAO,KAILL,EAAsBO,IAAIF,IAC5BG,EAAyBH,GAI3B,MAAMI,EAA0BC,GACvB,SAAUC,eAEG,UAAdD,GACFC,EAAEC,iBAGJ,MAAMC,EAAUF,EAAEG,OAElB,IAAIC,EAEJ,IAAIC,GAAY,EACZC,EACFN,aAAaO,WACTP,EAAEQ,SAC4B,QAA9BC,EAA4B,QAA5BC,EAACV,EAAiBW,eAAU,IAAAD,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,EAC7CI,EACFZ,aAAaO,WACTP,EAAEa,SAC4B,QAA9BC,EAA4B,QAA5BC,EAACf,EAAiBW,eAAU,IAAAI,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,EAEjDT,EAAQY,WAAW,KACbX,GACFZ,EAAOwB,kBAAkB,WAbN,KAiBvB,MAAMC,EAAgB,SAAUC,eAC9B,IAAKd,EAAW,OAEhB,MAAMe,EACJD,aAAqBZ,WACjBY,EAAUX,SAC4B,QAAtCC,EAAoC,QAApCC,EAACS,EAAyBR,eAAU,IAAAD,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,EACnDa,EACJF,aAAqBZ,WACjBY,EAAUN,SAC4B,QAAtCC,EAAoC,QAApCC,EAACI,EAAyBR,eAAU,IAAAI,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,GAIvDS,KAAKC,IAAIH,EAAQd,GAFG,IAGpBgB,KAAKC,IAAIF,EAAQT,GAHG,KAKpBY,GAEJ,EAEMA,EAAc,SAAUC,GAC5BpB,GAAY,EACZqB,aAAatB,GAGK,UAAdL,GACF4B,SAASC,oBAAoB,UAAWJ,GACxCG,SAASC,oBAAoB,YAAaV,KAE1CS,SAASC,oBAAoB,WAAYJ,GACzCG,SAASC,oBAAoB,cAAeJ,GAC5CG,SAASC,oBAAoB,YAAaV,IAE5ChB,EAAQ0B,oBAAoB,aAAcJ,EAC5C,EAGAtB,EAAQ2B,iBAAiB,aAAcL,EAAa,CAAEM,MAAM,IAE1C,UAAd/B,GACF4B,SAASE,iBAAiB,UAAWL,EAAa,CAAEM,MAAM,IAC1DH,SAASE,iBAAiB,YAAaX,EAAe,CACpDa,SAAS,MAGXJ,SAASE,iBAAiB,WAAYL,EAAa,CACjDM,MAAM,EACNC,SAAS,IAEXJ,SAASE,iBAAiB,cAAeL,EAAa,CACpDM,MAAM,EACNC,SAAS,IAEXJ,SAASE,iBAAiB,YAAaX,EAAe,CACpDa,SAAS,IAGf,EAGIC,EAAmBlC,EAAuB,SAC1CmC,EAAoBnC,EAAuB,SAcjD,OAXAJ,EAAUmC,iBAAiB,YAAaG,EAAkB,CAAED,SAAS,IACrErC,EAAUmC,iBAAiB,aAAcI,EAAmB,CAC1DF,SAAS,IAIX1C,EAAsB6C,IAAIxC,EAAW,CACnCsC,mBACAC,sBAGK,CACLE,QAAS,KACPtC,EAAyBH,GACzBD,EAAO0C,WAGb,CAEA,SAAStC,EAAyBH,GAChC,MAAM0C,EAAS/C,EAAsBgD,IAAI3C,GACrC0C,IAEF1C,EAAUkC,oBAAoB,YAAaQ,EAAOJ,kBAClDtC,EAAUkC,oBAAoB,aAAcQ,EAAOH,mBAGnD5C,EAAsBiD,OAAO5C,GAEjC"}