{"version":3,"file":"index-07722781.js","sources":["../../../../../Masa.Blazor.JS/src/mixins/long-press.ts"],"sourcesContent":["import { getDom } from \"utils/helper\";\r\n\r\n// 存储长按事件监听器的配置\r\nconst longPressEventConfigs: Map<\r\n  HTMLElement,\r\n  {\r\n    mousedownHandler: (e: MouseEvent) => void;\r\n    touchstartHandler: (e: TouchEvent) => void;\r\n  }\r\n> = new Map();\r\n\r\nexport function register(s: HTMLElement | string, dotnet: DotNet.DotNetObject) {\r\n  const container = getDom(s);\r\n  if (!container) {\r\n    return null;\r\n  }\r\n\r\n  // 如果已经注册过，先注销\r\n  if (longPressEventConfigs.has(container)) {\r\n    unregisterLongPressEvent(container);\r\n  }\r\n\r\n  // 使用事件委托来处理长按事件\r\n  const createLongPressHandler = (eventType: \"mouse\" | \"touch\") => {\r\n    return function (e: MouseEvent | TouchEvent) {\r\n      // 阻止默认行为，特别是触摸事件的默认行为\r\n      if (eventType === \"touch\") {\r\n        e.preventDefault();\r\n      }\r\n\r\n      const element = e.target as HTMLElement;\r\n\r\n      let timer: ReturnType<typeof setTimeout>;\r\n      const longPressDelay = 500; // 长按阈值（毫秒）\r\n      let isPressed = true;\r\n      let startX =\r\n        e instanceof MouseEvent\r\n          ? e.clientX\r\n          : (e as TouchEvent).touches?.[0]?.clientX || 0;\r\n      let startY =\r\n        e instanceof MouseEvent\r\n          ? e.clientY\r\n          : (e as TouchEvent).touches?.[0]?.clientY || 0;\r\n\r\n      timer = setTimeout(() => {\r\n        if (isPressed) {\r\n          dotnet.invokeMethodAsync(\"Invoke\");\r\n        }\r\n      }, longPressDelay);\r\n\r\n      const checkMovement = function (moveEvent: MouseEvent | TouchEvent) {\r\n        if (!isPressed) return;\r\n\r\n        const moveX =\r\n          moveEvent instanceof MouseEvent\r\n            ? moveEvent.clientX\r\n            : (moveEvent as TouchEvent).touches?.[0]?.clientX || 0;\r\n        const moveY =\r\n          moveEvent instanceof MouseEvent\r\n            ? moveEvent.clientY\r\n            : (moveEvent as TouchEvent).touches?.[0]?.clientY || 0;\r\n\r\n        const moveThreshold = 10; // 移动阈值（像素）\r\n        if (\r\n          Math.abs(moveX - startX) > moveThreshold ||\r\n          Math.abs(moveY - startY) > moveThreshold\r\n        ) {\r\n          cancelPress();\r\n        }\r\n      };\r\n\r\n      const cancelPress = function (event?: MouseEvent | TouchEvent) {\r\n        isPressed = false;\r\n        clearTimeout(timer);\r\n\r\n        // 清理所有监听器\r\n        if (eventType === \"mouse\") {\r\n          document.removeEventListener(\"mouseup\", cancelPress);\r\n          document.removeEventListener(\"mousemove\", checkMovement);\r\n        } else {\r\n          document.removeEventListener(\"touchend\", cancelPress);\r\n          document.removeEventListener(\"touchcancel\", cancelPress);\r\n          document.removeEventListener(\"touchmove\", checkMovement);\r\n        }\r\n        element.removeEventListener(\"mouseleave\", cancelPress);\r\n      };\r\n\r\n      // 添加监听器\r\n      element.addEventListener(\"mouseleave\", cancelPress, { once: true });\r\n\r\n      if (eventType === \"mouse\") {\r\n        document.addEventListener(\"mouseup\", cancelPress, { once: true });\r\n        document.addEventListener(\"mousemove\", checkMovement, {\r\n          passive: false,\r\n        });\r\n      } else {\r\n        document.addEventListener(\"touchend\", cancelPress, {\r\n          once: true,\r\n          passive: false,\r\n        });\r\n        document.addEventListener(\"touchcancel\", cancelPress, {\r\n          once: true,\r\n          passive: false,\r\n        });\r\n        document.addEventListener(\"touchmove\", checkMovement, {\r\n          passive: false,\r\n        });\r\n      }\r\n    };\r\n  };\r\n\r\n  const mousedownHandler = createLongPressHandler(\"mouse\");\r\n  const touchstartHandler = createLongPressHandler(\"touch\");\r\n\r\n  // 添加事件监听器\r\n  container.addEventListener(\"mousedown\", mousedownHandler, { passive: false });\r\n  container.addEventListener(\"touchstart\", touchstartHandler, {\r\n    passive: false,\r\n  });\r\n\r\n  // 保存监听器引用\r\n  longPressEventConfigs.set(container, {\r\n    mousedownHandler,\r\n    touchstartHandler,\r\n  });\r\n\r\n  return {\r\n    dispose: () => {\r\n      unregisterLongPressEvent(container);\r\n      dotnet.dispose();\r\n    },\r\n  };\r\n}\r\n\r\nfunction unregisterLongPressEvent(container: HTMLElement) {\r\n  const config = longPressEventConfigs.get(container);\r\n  if (config) {\r\n    // 移除事件监听器\r\n    container.removeEventListener(\"mousedown\", config.mousedownHandler);\r\n    container.removeEventListener(\"touchstart\", config.touchstartHandler);\r\n\r\n    // 从配置中删除\r\n    longPressEventConfigs.delete(container);\r\n  }\r\n}\r\n"],"names":["longPressEventConfigs","Map","register","s","dotnet","container","getDom","has","unregisterLongPressEvent","createLongPressHandler","eventType","e","preventDefault","element","target","timer","isPressed","startX","MouseEvent","clientX","_b","_a","touches","startY","clientY","_d","_c","setTimeout","invokeMethodAsync","checkMovement","moveEvent","moveX","moveY","Math","abs","cancelPress","event","clearTimeout","document","removeEventListener","addEventListener","once","passive","mousedownHandler","touchstartHandler","set","dispose","config","get","delete"],"mappings":"oDAGA,MAAMA,EAMF,IAAIC,IAEQ,SAAAC,EAASC,EAAyBC,GAChD,MAAMC,EAAYC,EAAOH,GACzB,IAAKE,EACH,OAAO,KAILL,EAAsBO,IAAIF,IAC5BG,EAAyBH,GAI3B,MAAMI,EAA0BC,GACvB,SAAUC,eAEG,UAAdD,GACFC,EAAEC,iBAGJ,MAAMC,EAAUF,EAAEG,OAElB,IAAIC,EAEJ,IAAIC,GAAY,EACZC,EACFN,aAAaO,WACTP,EAAEQ,SAC4B,QAA9BC,EAA4B,QAA5BC,EAACV,EAAiBW,eAAU,IAAAD,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,EAC7CI,EACFZ,aAAaO,WACTP,EAAEa,SAC4B,QAA9BC,EAA4B,QAA5BC,EAACf,EAAiBW,eAAU,IAAAI,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,EAEjDT,EAAQY,YAAW,KACbX,GACFZ,EAAOwB,kBAAkB,SAC1B,GAdoB,KAiBvB,MAAMC,EAAgB,SAAUC,eAC9B,IAAKd,EAAW,OAEhB,MAAMe,EACJD,aAAqBZ,WACjBY,EAAUX,SAC4B,QAAtCC,EAAoC,QAApCC,EAACS,EAAyBR,eAAU,IAAAD,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,EACnDa,EACJF,aAAqBZ,WACjBY,EAAUN,SAC4B,QAAtCC,EAAoC,QAApCC,EAACI,EAAyBR,eAAU,IAAAI,OAAA,EAAAA,EAAA,UAAE,IAAAD,OAAA,EAAAA,EAAED,UAAW,GAIvDS,KAAKC,IAAIH,EAAQd,GAFG,IAGpBgB,KAAKC,IAAIF,EAAQT,GAHG,KAKpBY,GAEJ,EAEMA,EAAc,SAAUC,GAC5BpB,GAAY,EACZqB,aAAatB,GAGK,UAAdL,GACF4B,SAASC,oBAAoB,UAAWJ,GACxCG,SAASC,oBAAoB,YAAaV,KAE1CS,SAASC,oBAAoB,WAAYJ,GACzCG,SAASC,oBAAoB,cAAeJ,GAC5CG,SAASC,oBAAoB,YAAaV,IAE5ChB,EAAQ0B,oBAAoB,aAAcJ,EAC5C,EAGAtB,EAAQ2B,iBAAiB,aAAcL,EAAa,CAAEM,MAAM,IAE1C,UAAd/B,GACF4B,SAASE,iBAAiB,UAAWL,EAAa,CAAEM,MAAM,IAC1DH,SAASE,iBAAiB,YAAaX,EAAe,CACpDa,SAAS,MAGXJ,SAASE,iBAAiB,WAAYL,EAAa,CACjDM,MAAM,EACNC,SAAS,IAEXJ,SAASE,iBAAiB,cAAeL,EAAa,CACpDM,MAAM,EACNC,SAAS,IAEXJ,SAASE,iBAAiB,YAAaX,EAAe,CACpDa,SAAS,IAGf,EAGIC,EAAmBlC,EAAuB,SAC1CmC,EAAoBnC,EAAuB,SAcjD,OAXAJ,EAAUmC,iBAAiB,YAAaG,EAAkB,CAAED,SAAS,IACrErC,EAAUmC,iBAAiB,aAAcI,EAAmB,CAC1DF,SAAS,IAIX1C,EAAsB6C,IAAIxC,EAAW,CACnCsC,mBACAC,sBAGK,CACLE,QAAS,KACPtC,EAAyBH,GACzBD,EAAO0C,SAAS,EAGtB,CAEA,SAAStC,EAAyBH,GAChC,MAAM0C,EAAS/C,EAAsBgD,IAAI3C,GACrC0C,IAEF1C,EAAUkC,oBAAoB,YAAaQ,EAAOJ,kBAClDtC,EAAUkC,oBAAoB,aAAcQ,EAAOH,mBAGnD5C,EAAsBiD,OAAO5C,GAEjC"}