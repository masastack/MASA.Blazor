{"version":3,"file":"touch-f9d2ba92.js","sources":["../../../../../Masa.Blazor.JS/src/components/window/touch.ts"],"sourcesContent":["export interface TouchData {\r\n  touchstartX: number;\r\n  touchstartY: number;\r\n  touchmoveX: number;\r\n  touchmoveY: number;\r\n  touchendX: number;\r\n  touchendY: number;\r\n  offsetX: number;\r\n  offsetY: number;\r\n}\r\n\r\nexport type TouchWrapper = TouchData & { dotnetHelper: DotNet.DotNetObject };\r\n\r\nexport interface TouchValue {\r\n  parent?: boolean;\r\n  options?: {\r\n    touchstart?: AddEventListenerOptions & { stopPropagation?: boolean };\r\n    touchmove?: AddEventListenerOptions & { stopPropagation?: boolean };\r\n    touchend?: AddEventListenerOptions & { stopPropagation?: boolean };\r\n  };\r\n}\r\n\r\nexport interface TouchStoredHandlers {\r\n  touchstart: (e: TouchEvent) => void;\r\n  touchend: (e: TouchEvent) => void;\r\n  touchmove: (e: TouchEvent) => void;\r\n}\r\n\r\nconst handleGesture = (wrapper: TouchWrapper) => {\r\n  const { touchstartX, touchendX, touchstartY, touchendY, dotnetHelper } =\r\n    wrapper;\r\n  const dirRatio = 0.5;\r\n  const minDistance = 16;\r\n  wrapper.offsetX = touchendX - touchstartX;\r\n  wrapper.offsetY = touchendY - touchstartY;\r\n\r\n  if (Math.abs(wrapper.offsetY) < dirRatio * Math.abs(wrapper.offsetX)) {\r\n    if (touchendX < touchstartX - minDistance) {\r\n      dotnetHelper.invokeMethodAsync(\"OnTouchend\", \"left\" /*, wrapper*/);\r\n    }\r\n    if (touchendX > touchstartX + minDistance) {\r\n      dotnetHelper.invokeMethodAsync(\"OnTouchend\", \"right\" /*, wrapper*/);\r\n    }\r\n  }\r\n\r\n  if (Math.abs(wrapper.offsetX) < dirRatio * Math.abs(wrapper.offsetY)) {\r\n    if (touchendY < touchstartY - minDistance) {\r\n      dotnetHelper.invokeMethodAsync(\"OnTouchend\", \"up\" /*, wrapper*/);\r\n    }\r\n    if (touchendY > touchstartY + minDistance) {\r\n      dotnetHelper.invokeMethodAsync(\"OnTouchend\", \"down\" /*, wrapper*/);\r\n    }\r\n  }\r\n};\r\n\r\nfunction touchstart(event: TouchEvent, wrapper: TouchWrapper) {\r\n  const { dotnetHelper } = wrapper;\r\n  const touch = event.changedTouches[0];\r\n  wrapper.touchstartX = touch.clientX;\r\n  wrapper.touchstartY = touch.clientY;\r\n\r\n  // dotnetHelper.invokeMethodAsync(\"OnTouch\", \"start\", {\r\n  //   originEvent: event,\r\n  //   ...wrapper,\r\n  // });\r\n}\r\n\r\nfunction touchend(event: TouchEvent, wrapper: TouchWrapper) {\r\n  const { dotnetHelper } = wrapper;\r\n  const touch = event.changedTouches[0];\r\n  wrapper.touchendX = touch.clientX;\r\n  wrapper.touchendY = touch.clientY;\r\n\r\n  // dotnetHelper.invokeMethodAsync(\"OnTouch\", \"end\", {\r\n  //   originEvent: event,\r\n  //   ...wrapper,\r\n  // });\r\n\r\n  handleGesture(wrapper);\r\n}\r\n\r\nfunction touchmove(event: TouchEvent, wrapper: TouchWrapper) {\r\n  const { dotnetHelper } = wrapper;\r\n  const touch = event.changedTouches[0];\r\n  wrapper.touchmoveX = touch.clientX;\r\n  wrapper.touchmoveY = touch.clientY;\r\n\r\n  // dotnetHelper.invokeMethodAsync(\"OnTouch\", \"move\", {\r\n  //   originEvent: event,\r\n  //   ...wrapper,\r\n  // });\r\n}\r\n\r\nfunction createHandlers(\r\n  options: TouchValue[\"options\"],\r\n  dotnetHelper: DotNet.DotNetObject\r\n): TouchStoredHandlers {\r\n  const wrapper = {\r\n    touchstartX: 0,\r\n    touchstartY: 0,\r\n    touchendX: 0,\r\n    touchendY: 0,\r\n    touchmoveX: 0,\r\n    touchmoveY: 0,\r\n    offsetX: 0,\r\n    offsetY: 0,\r\n    dotnetHelper,\r\n  };\r\n\r\n  return {\r\n    touchstart: (e: TouchEvent) => {\r\n      options.touchstart?.stopPropagation && e.stopPropagation();\r\n      touchstart(e, wrapper);\r\n    },\r\n    touchend: (e: TouchEvent) => {\r\n      options.touchend?.stopPropagation && e.stopPropagation();\r\n      touchend(e, wrapper);\r\n    },\r\n    touchmove: (e: TouchEvent) => {\r\n      options.touchmove?.stopPropagation && e.stopPropagation();\r\n      touchmove(e, wrapper);\r\n    },\r\n  };\r\n}\r\n\r\nlet touchHandlersId = 0;\r\n\r\nexport function useTouch(\r\n  el: HTMLElement,\r\n  value?: TouchValue,\r\n  dotnetHelper?: any\r\n) {\r\n  const target = value?.parent ? el.parentElement : el;\r\n  const options = value?.options ?? {};\r\n\r\n  if (!target) return null;\r\n\r\n  const handlers = createHandlers(options, dotnetHelper);\r\n\r\n  target._touchHandlers = target._touchHandlers ?? Object.create(null);\r\n  target._touchHandlers![touchHandlersId] = handlers;\r\n\r\n  Object.keys(handlers).forEach((eventName) => {\r\n    const { stopPropagation, ...eventOptions } =\r\n      options[eventName] ?? ({ passive: true } as AddEventListenerOptions);\r\n    target.addEventListener(eventName, handlers[eventName], eventOptions);\r\n  });\r\n\r\n  return touchHandlersId++;\r\n}\r\n\r\nexport function cleanupTouch(el: HTMLElement, id: number) {\r\n  if (!el) return;\r\n\r\n  const target = el._touchHandlers;\r\n\r\n  if (!target || !target[id]) return;\r\n\r\n  const handlers = target[id];\r\n\r\n  Object.keys(handlers).forEach((eventName) => {\r\n    el.removeEventListener(eventName, handlers[eventName]);\r\n  });\r\n\r\n  delete target[id];\r\n}\r\n"],"names":["touchend","event","wrapper","touch","changedTouches","touchendX","clientX","touchendY","clientY","touchstartX","touchstartY","dotnetHelper","offsetX","offsetY","Math","abs","invokeMethodAsync","handleGesture","touchHandlersId","useTouch","el","value","target","parent","parentElement","options","_a","handlers","touchmoveX","touchmoveY","touchstart","e","stopPropagation","touchmove","createHandlers","_touchHandlers","_b","Object","create","keys","forEach","eventName","passive","eventOptions","__rest","addEventListener","cleanupTouch","id","removeEventListener"],"mappings":"uDAmEA,SAASA,EAASC,EAAmBC,GAEnC,MAAMC,EAAQF,EAAMG,eAAe,GACnCF,EAAQG,UAAYF,EAAMG,QAC1BJ,EAAQK,UAAYJ,EAAMK,QA3CN,CAACN,IACrB,MAAMO,YAAEA,EAAWJ,UAAEA,EAASK,YAAEA,EAAWH,UAAEA,EAASI,aAAEA,GACtDT,EAGFA,EAAQU,QAAUP,EAAYI,EAC9BP,EAAQW,QAAUN,EAAYG,EAE1BI,KAAKC,IAAIb,EAAQW,SALJ,GAK0BC,KAAKC,IAAIb,EAAQU,WACtDP,EAAYI,EALE,IAMhBE,EAAaK,kBAAkB,aAAc,QAE3CX,EAAYI,EARE,IAShBE,EAAaK,kBAAkB,aAAc,UAI7CF,KAAKC,IAAIb,EAAQU,SAdJ,GAc0BE,KAAKC,IAAIb,EAAQW,WACtDN,EAAYG,EAdE,IAehBC,EAAaK,kBAAkB,aAAc,MAE3CT,EAAYG,EAjBE,IAkBhBC,EAAaK,kBAAkB,aAAc,QAEhD,EA0BDC,CAAcf,EAChB,CA8CA,IAAIgB,EAAkB,WAENC,EACdC,EACAC,EACAV,WAEA,MAAMW,GAASD,aAAK,EAALA,EAAOE,QAASH,EAAGI,cAAgBJ,EAC5CK,EAA4B,QAAlBC,EAAAL,aAAA,EAAAA,EAAOI,eAAW,IAAAC,EAAAA,EAAA,GAElC,IAAKJ,EAAQ,OAAO,KAEpB,MAAMK,EA5CR,SACEF,EACAd,GAEA,MAAMT,EAAU,CACdO,YAAa,EACbC,YAAa,EACbL,UAAW,EACXE,UAAW,EACXqB,WAAY,EACZC,WAAY,EACZjB,QAAS,EACTC,QAAS,EACTF,gBAGF,MAAO,CACLmB,WAAaC,WACO,QAAlBL,EAAAD,EAAQK,kBAAU,IAAAJ,OAAA,EAAAA,EAAEM,kBAAmBD,EAAEC,kBAxD/C,SAAoB/B,EAAmBC,GAErC,MAAMC,EAAQF,EAAMG,eAAe,GACnCF,EAAQO,YAAcN,EAAMG,QAC5BJ,EAAQQ,YAAcP,EAAMK,OAM9B,CA+CMsB,CAAWC,EAAG7B,EAAQ,EAExBF,SAAW+B,WACO,QAAhBL,EAAAD,EAAQzB,gBAAQ,IAAA0B,OAAA,EAAAA,EAAEM,kBAAmBD,EAAEC,kBACvChC,EAAS+B,EAAG7B,EAAQ,EAEtB+B,UAAYF,WACO,QAAjBL,EAAAD,EAAQQ,iBAAS,IAAAP,OAAA,EAAAA,EAAEM,kBAAmBD,EAAEC,kBAtC9C,SAAmB/B,EAAmBC,GAEpC,MAAMC,EAAQF,EAAMG,eAAe,GACnCF,EAAQ0B,WAAazB,EAAMG,QAC3BJ,EAAQ2B,WAAa1B,EAAMK,OAM7B,CA6BMyB,CAAUF,EAAG7B,EAAQ,EAG3B,CAcmBgC,CAAeT,EAASd,GAWzC,OATAW,EAAOa,eAA0C,QAAzBC,EAAAd,EAAOa,sBAAkB,IAAAC,EAAAA,EAAAC,OAAOC,OAAO,MAC/DhB,EAAOa,eAAgBjB,GAAmBS,EAE1CU,OAAOE,KAAKZ,GAAUa,SAASC,UACvB,MAAAL,EACc,UAAlBX,EAAQgB,UAAU,IAAAf,EAAAA,EAAK,CAAEgB,SAAS,GADRC,EAAYC,EAAAR,EAAlC,CAAoC,oBAE1Cd,EAAOuB,iBAAiBJ,EAAWd,EAASc,GAAYE,EAAa,IAGhEzB,GACT,CAEgB,SAAA4B,EAAa1B,EAAiB2B,GAC5C,IAAK3B,EAAI,OAET,MAAME,EAASF,EAAGe,eAElB,IAAKb,IAAWA,EAAOyB,GAAK,OAE5B,MAAMpB,EAAWL,EAAOyB,GAExBV,OAAOE,KAAKZ,GAAUa,SAASC,IAC7BrB,EAAG4B,oBAAoBP,EAAWd,EAASc,GAAW,WAGjDnB,EAAOyB,EAChB"}