{"version":3,"file":"scroll-strategy.js","sources":["../../../../../Masa.Blazor.JS/src/utils/getScrollParent.ts","../../../../../Masa.Blazor.JS/src/components/overlay/scroll-strategy.ts"],"sourcesContent":["export function getScrollParent (el?: HTMLElement) {\r\n  while (el) {\r\n    if (hasScrollbar(el)) return el\r\n    el = el.parentElement!\r\n  }\r\n\r\n  return document.scrollingElement as HTMLElement\r\n}\r\n\r\nexport function getScrollParents (el?: Element | null, stopAt?: Element | null) {\r\n  const elements: HTMLElement[] = []\r\n\r\n  if (stopAt && el && !stopAt.contains(el)) return elements\r\n\r\n  while (el) {\r\n    if (hasScrollbar(el)) elements.push(el as HTMLElement)\r\n    if (el === stopAt) break\r\n    el = el.parentElement!\r\n  }\r\n\r\n  return elements\r\n}\r\n\r\nexport function hasScrollbar (el?: Element | null) {\r\n  if (!el || el.nodeType !== Node.ELEMENT_NODE) return false\r\n\r\n  const style = window.getComputedStyle(el)\r\n  return style.overflowY === 'scroll' || (style.overflowY === 'auto' && el.scrollHeight > el.clientHeight)\r\n}\r\n","import { getScrollParents, hasScrollbar } from \"utils/getScrollParent\";\r\nimport { convertToUnit } from \"utils/helper\";\r\n\r\ntype StrategyProps = {\r\n  strategy: \"none\" | \"block\" | \"close\" | \"reposition\";\r\n  contained: boolean | undefined;\r\n};\r\n\r\ntype ScrollStrategyData = {\r\n  root: HTMLElement | undefined;\r\n  contentEl: HTMLElement | undefined;\r\n  targetEl: HTMLElement | undefined;\r\n  invoker?: DotNet.DotNetObject;\r\n};\r\n\r\ntype ScrollStrategyResult = {\r\n  bind?: () => void;\r\n  unbind: () => void;\r\n};\r\n\r\nexport function useScrollStrategies(\r\n  props: StrategyProps,\r\n  root: HTMLElement | undefined,\r\n  contentEl: HTMLElement | undefined,\r\n  targetEl: HTMLElement | undefined,\r\n  dotNet?: DotNet.DotNetObject\r\n): ScrollStrategyResult {\r\n  if (props.strategy === \"block\") {\r\n    return useBlockScrollStrategy(\r\n      {\r\n        root,\r\n        contentEl,\r\n        targetEl,\r\n      },\r\n      props\r\n    );\r\n  } else {\r\n    return useInvokerScrollStrategy(\r\n      {\r\n        root,\r\n        contentEl,\r\n        targetEl,\r\n        invoker: dotNet,\r\n      },\r\n      props\r\n    );\r\n  }\r\n}\r\n\r\nfunction useBlockScrollStrategy(\r\n  data: ScrollStrategyData,\r\n  options: StrategyProps\r\n): ScrollStrategyResult {\r\n  const offsetParent = data.root.offsetParent;\r\n  const scrollElements = [\r\n    ...new Set([\r\n      ...getScrollParents(\r\n        data.contentEl,\r\n        options.contained ? offsetParent : undefined\r\n      ),\r\n    ]),\r\n  ];\r\n\r\n  const scrollableParent = ((el) => hasScrollbar(el) && el)(\r\n    offsetParent || document.documentElement\r\n  );\r\n\r\n  const bind = () => {\r\n    if (scrollableParent) {\r\n      data.root.classList.add(\"m-overlay--scroll-blocked\");\r\n    }\r\n\r\n    const scrollbarWidth =\r\n      window.innerWidth - document.documentElement.offsetWidth;\r\n\r\n    scrollElements\r\n      .filter((el) => !el.classList.contains(\"m-overlay-scroll-blocked\"))\r\n      .forEach((el, i) => {\r\n        el.style.setProperty(\r\n          \"--m-body-scroll-x\",\r\n          convertToUnit(-el.scrollLeft)\r\n        );\r\n        el.style.setProperty(\"--m-body-scroll-y\", convertToUnit(-el.scrollTop));\r\n\r\n        if (el !== document.documentElement) {\r\n          el.style.setProperty(\r\n            \"--m-scrollbar-offset\",\r\n            convertToUnit(scrollbarWidth)\r\n          );\r\n        }\r\n\r\n        el.classList.add(\"m-overlay-scroll-blocked\");\r\n      });\r\n  };\r\n\r\n  bind();\r\n\r\n  return {\r\n    bind,\r\n    unbind: () => {\r\n      scrollElements\r\n        .filter((el) => el.classList.contains(\"m-overlay-scroll-blocked\"))\r\n        .forEach((el, i) => {\r\n          const x = parseFloat(el.style.getPropertyValue(\"--m-body-scroll-x\"));\r\n          const y = parseFloat(el.style.getPropertyValue(\"--m-body-scroll-y\"));\r\n\r\n          const scrollBehavior = el.style.scrollBehavior;\r\n\r\n          el.style.scrollBehavior = \"auto\";\r\n          el.style.removeProperty(\"--m-body-scroll-x\");\r\n          el.style.removeProperty(\"--m-body-scroll-y\");\r\n          el.style.removeProperty(\"--m-scrollbar-offset\");\r\n          el.classList.remove(\"m-overlay-scroll-blocked\");\r\n\r\n          el.scrollLeft = -x;\r\n          el.scrollTop = -y;\r\n\r\n          el.style.scrollBehavior = scrollBehavior;\r\n        });\r\n\r\n      if (scrollableParent) {\r\n        data.root.classList.remove(\"m-overlay--scroll-blocked\");\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nfunction useInvokerScrollStrategy(\r\n  data: ScrollStrategyData,\r\n  options: StrategyProps\r\n) {\r\n  const el = data.targetEl ?? data.contentEl;\r\n\r\n  const onScroll = () => {\r\n    data.invoker?.invokeMethodAsync(\r\n      \"ScrollStrategy_OnScroll\",\r\n      options.strategy\r\n    );\r\n  };\r\n\r\n  const scrollElements = [document, ...getScrollParents(el)];\r\n  scrollElements.forEach((el) =>\r\n    el.addEventListener(\"scroll\", onScroll, { passive: true })\r\n  );\r\n\r\n  return {\r\n    unbind: () => {\r\n      data.invoker?.dispose();\r\n      scrollElements.forEach((el) =>\r\n        el.removeEventListener(\"scroll\", onScroll)\r\n      );\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}