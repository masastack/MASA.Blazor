{"version":3,"file":"index-3d21987e.js","sources":["../../../../../Masa.Blazor.JS/src/components/page-stack/index.ts"],"sourcesContent":["import debounceIt from \"just-debounce-it\";\r\nimport { convertToUnit } from \"utils/helper\";\r\n\r\nconst dotnetRefs: { [prop: number]: DotNet.DotNetObject } = {};\r\nconst clickHandlers: { [prop: number]: (e: MouseEvent) => void } = {};\r\nconst popstateHandlers: { [prop: number]: () => void } = {};\r\nconst scrollHandlers: { [prop: number]: () => void } = {};\r\nlet nextId = 0;\r\n\r\nexport function attachListener(handle: DotNet.DotNetObject) {\r\n  const id = nextId;\r\n  const clickHandler = (event: MouseEvent) => onDocumentClick(id, event);\r\n  const popstateHandler = () =>\r\n    handle.invokeMethodAsync(\"Popstate\", window.location.pathname);\r\n  const scrollHandler = debounceIt(() => {\r\n    handle.invokeMethodAsync(\"Scroll\", window.pageYOffset)\r\n  }, 100);\r\n  clickHandlers[id] = clickHandler;\r\n  popstateHandlers[id] = popstateHandler;\r\n  scrollHandlers[id] = scrollHandler;\r\n  dotnetRefs[id] = handle;\r\n\r\n  document.addEventListener(\"click\", clickHandler);\r\n  window.addEventListener(\"popstate\", popstateHandler);\r\n  window.addEventListener(\"scroll\", scrollHandler, { passive: true });\r\n\r\n  return nextId++;\r\n}\r\n\r\nasync function onDocumentClick(id: number, event: MouseEvent) {\r\n  const dotnet = dotnetRefs[id];\r\n  if (dotnet === null) return;\r\n\r\n  const anchor = event.target.closest(\"a\");\r\n  if (!anchor) return;\r\n\r\n  const href = anchor.getAttribute(\"href\");\r\n  if (!href) return;\r\n\r\n  let strategy = anchor.getAttribute(\"data-page-stack-strategy\");\r\n  strategy = strategy === null ? null : strategy.toLowerCase();\r\n  if (strategy === \"\" || strategy === \"true\" || strategy === \"push\") {\r\n    if (!document.querySelector(\"[page-stack-id]\")) {\r\n      blockScroll();\r\n    }\r\n\r\n    await dotnet.invokeMethodAsync(\"Push\", href);\r\n  }\r\n}\r\n\r\nexport function blockScroll() {\r\n  const doc = document.documentElement;\r\n\r\n  if (doc.classList.contains(\"m-page-stack-scroll-blocked\")) {\r\n    return;\r\n  }\r\n\r\n  if (doc.scrollLeft === 0 && doc.scrollTop === 0) {\r\n    return;\r\n  }\r\n\r\n  doc.style.setProperty(\"--m-page-stack-scroll-x\", convertToUnit(-doc.scrollLeft));\r\n  doc.style.setProperty(\"--m-page-stack-scroll-y\", convertToUnit(-doc.scrollTop));\r\n  doc.classList.add(\"m-page-stack-scroll-blocked\");\r\n}\r\n\r\nexport function unblockScroll() {\r\n  const doc = document.documentElement;\r\n  if (!doc.classList.contains(\"m-page-stack-scroll-blocked\")) {\r\n    return;\r\n  }\r\n\r\n  const x = parseFloat(doc.style.getPropertyValue(\"--m-page-stack-scroll-x\"));\r\n  const y = parseFloat(doc.style.getPropertyValue(\"--m-page-stack-scroll-y\"));\r\n\r\n  const scrollBehavior = doc.style.scrollBehavior;\r\n\r\n  doc.style.scrollBehavior = \"auto\";\r\n  doc.style.removeProperty(\"--m-page-stack-scroll-x\");\r\n  doc.style.removeProperty(\"--m-page-stack-scroll-y\");\r\n  doc.classList.remove(\"m-page-stack-scroll-blocked\");\r\n\r\n  doc.scrollLeft = -x;\r\n  doc.scrollTop = -y;\r\n\r\n  doc.style.scrollBehavior = scrollBehavior;\r\n}\r\n\r\nexport function detachListener(id: number) {\r\n  const clickHandler = clickHandlers[id];\r\n  if (clickHandler) {\r\n    document.removeEventListener(\"click\", clickHandler);\r\n    delete clickHandlers[id];\r\n  }\r\n\r\n  const popstateHandler = popstateHandlers[id];\r\n  if (popstateHandler) {\r\n    window.removeEventListener(\"popstate\", popstateHandler);\r\n    delete popstateHandlers[id];\r\n  }\r\n\r\n  const scrollHandler = scrollHandlers[id];\r\n  if (scrollHandler) {\r\n    window.removeEventListener(\"scroll\", scrollHandler, { passive: true } as any);\r\n    delete scrollHandlers[id];\r\n  }\r\n\r\n  dotnetRefs[id] && dotnetRefs[id].dispose();\r\n  delete dotnetRefs[id];\r\n}\r\n"],"names":["dotnetRefs","clickHandlers","popstateHandlers","scrollHandlers","nextId","attachListener","handle","id","clickHandler","event","dotnet","anchor","target","closest","href","getAttribute","strategy","toLowerCase","document","querySelector","blockScroll","invokeMethodAsync","onDocumentClick","popstateHandler","window","location","pathname","scrollHandler","debounceIt","pageYOffset","addEventListener","passive","doc","documentElement","classList","contains","scrollLeft","scrollTop","style","setProperty","convertToUnit","add","unblockScroll","x","parseFloat","getPropertyValue","y","scrollBehavior","removeProperty","remove","detachListener","removeEventListener","dispose"],"mappings":"8JAGA,MAAMA,EAAsD,CAAA,EACtDC,EAA6D,CAAA,EAC7DC,EAAmD,CAAA,EACnDC,EAAiD,CAAA,EACvD,IAAIC,EAAS,EAEP,SAAUC,EAAeC,GAC7B,MAAMC,EAAKH,EACLI,EAAgBC,GAkBxB,SAA+BF,EAAYE,4CACzC,MAAMC,EAASV,EAAWO,GAC1B,GAAe,OAAXG,EAAiB,OAErB,MAAMC,EAASF,EAAMG,OAAOC,QAAQ,KACpC,IAAKF,EAAQ,OAEb,MAAMG,EAAOH,EAAOI,aAAa,QACjC,IAAKD,EAAM,OAEX,IAAIE,EAAWL,EAAOI,aAAa,4BACnCC,EAAwB,OAAbA,EAAoB,KAAOA,EAASC,cAC9B,KAAbD,GAAgC,SAAbA,GAAoC,SAAbA,IACvCE,SAASC,cAAc,oBAC1BC,UAGIV,EAAOW,kBAAkB,OAAQP,MAE1C,CArC6CQ,CAAgBf,EAAIE,GAC1Dc,EAAkB,IACtBjB,EAAOe,kBAAkB,WAAYG,OAAOC,SAASC,UACjDC,EAAgBC,GAAW,KAC/BtB,EAAOe,kBAAkB,SAAUG,OAAOK,YAAY,GACrD,KAUH,OATA5B,EAAcM,GAAMC,EACpBN,EAAiBK,GAAMgB,EACvBpB,EAAeI,GAAMoB,EACrB3B,EAAWO,GAAMD,EAEjBY,SAASY,iBAAiB,QAAStB,GACnCgB,OAAOM,iBAAiB,WAAYP,GACpCC,OAAOM,iBAAiB,SAAUH,EAAe,CAAEI,SAAS,IAErD3B,GACT,UAuBgBgB,IACd,MAAMY,EAAMd,SAASe,gBAEjBD,EAAIE,UAAUC,SAAS,gCAIJ,IAAnBH,EAAII,YAAsC,IAAlBJ,EAAIK,YAIhCL,EAAIM,MAAMC,YAAY,0BAA2BC,GAAeR,EAAII,aACpEJ,EAAIM,MAAMC,YAAY,0BAA2BC,GAAeR,EAAIK,YACpEL,EAAIE,UAAUO,IAAI,+BACpB,UAEgBC,IACd,MAAMV,EAAMd,SAASe,gBACrB,IAAKD,EAAIE,UAAUC,SAAS,+BAC1B,OAGF,MAAMQ,EAAIC,WAAWZ,EAAIM,MAAMO,iBAAiB,4BAC1CC,EAAIF,WAAWZ,EAAIM,MAAMO,iBAAiB,4BAE1CE,EAAiBf,EAAIM,MAAMS,eAEjCf,EAAIM,MAAMS,eAAiB,OAC3Bf,EAAIM,MAAMU,eAAe,2BACzBhB,EAAIM,MAAMU,eAAe,2BACzBhB,EAAIE,UAAUe,OAAO,+BAErBjB,EAAII,YAAcO,EAClBX,EAAIK,WAAaS,EAEjBd,EAAIM,MAAMS,eAAiBA,CAC7B,CAEM,SAAUG,EAAe3C,GAC7B,MAAMC,EAAeP,EAAcM,GAC/BC,IACFU,SAASiC,oBAAoB,QAAS3C,UAC/BP,EAAcM,IAGvB,MAAMgB,EAAkBrB,EAAiBK,GACrCgB,IACFC,OAAO2B,oBAAoB,WAAY5B,UAChCrB,EAAiBK,IAG1B,MAAMoB,EAAgBxB,EAAeI,GACjCoB,IACFH,OAAO2B,oBAAoB,SAAUxB,EAAe,CAAEI,SAAS,WACxD5B,EAAeI,IAGxBP,EAAWO,IAAOP,EAAWO,GAAI6C,iBAC1BpD,EAAWO,EACpB"}