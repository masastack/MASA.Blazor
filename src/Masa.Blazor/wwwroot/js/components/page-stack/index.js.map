{"version":3,"file":"index.js","sources":["../../../../../Masa.Blazor.JS/src/components/page-stack/index.ts"],"sourcesContent":["const dotnetRefs: { [prop: number]: DotNet.DotNetObject } = {};\r\nconst clickHandlers: { [prop: number]: (e: MouseEvent) => void } = {};\r\nconst popstateHandlers: { [prop: number]: () => void } = {};\r\nlet nextId = 0;\r\n\r\nexport function attachListener(handle: DotNet.DotNetObject) {\r\n  const id = nextId;\r\n  const clickHandler = (event: MouseEvent) => onDocumentClick(id, event);\r\n  const popstateHandler = () =>\r\n    handle.invokeMethodAsync(\"Popstate\", window.location.pathname);\r\n  clickHandlers[id] = clickHandler;\r\n  popstateHandlers[id] = popstateHandler;\r\n  dotnetRefs[id] = handle;\r\n\r\n  document.addEventListener(\"click\", clickHandler);\r\n  window.addEventListener(\"popstate\", popstateHandler);\r\n\r\n  return nextId++;\r\n}\r\n\r\nasync function onDocumentClick(id: number, event: MouseEvent) {\r\n  const dotnet = dotnetRefs[id];\r\n  if (dotnet === null) return;\r\n\r\n  const anchor = event.target.closest(\"a\");\r\n  if (!anchor) return;\r\n\r\n  const href = anchor.getAttribute(\"href\");\r\n  if (!href) return;\r\n\r\n  let strategy = anchor.getAttribute(\"data-page-stack-strategy\");\r\n  strategy = strategy === null ? null : strategy.toLowerCase();\r\n  if (strategy === \"\" || strategy === \"true\" || strategy === \"push\") {\r\n    await dotnet.invokeMethodAsync(\"Push\", href);\r\n  }\r\n}\r\n\r\nexport function detachListener(id: number) {\r\n  const clickHandler = clickHandlers[id];\r\n  if (clickHandler) {\r\n    document.removeEventListener(\"click\", clickHandler);\r\n  }\r\n\r\n  const popstateHandler = popstateHandlers[id];\r\n  if (popstateHandler) {\r\n    window.removeEventListener(\"popstate\", popstateHandler);\r\n  }\r\n\r\n  dotnetRefs[id] && dotnetRefs[id].dispose();\r\n\r\n  delete clickHandlers[id];\r\n  delete popstateHandlers[id];\r\n  delete dotnetRefs[id];\r\n}\r\n"],"names":[],"mappings":";;AAAA,MAAM,UAAU,GAA4C,EAAE,CAAC;AAC/D,MAAM,aAAa,GAAgD,EAAE,CAAC;AACtE,MAAM,gBAAgB,GAAmC,EAAE,CAAC;AAC5D,IAAI,MAAM,GAAG,CAAC,CAAC;AAET,SAAU,cAAc,CAAC,MAA2B,EAAA;IACxD,MAAM,EAAE,GAAG,MAAM,CAAC;AAClB,IAAA,MAAM,YAAY,GAAG,CAAC,KAAiB,KAAK,eAAe,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;AACvE,IAAA,MAAM,eAAe,GAAG,MACtB,MAAM,CAAC,iBAAiB,CAAC,UAAU,EAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AACjE,IAAA,aAAa,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC;AACjC,IAAA,gBAAgB,CAAC,EAAE,CAAC,GAAG,eAAe,CAAC;AACvC,IAAA,UAAU,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC;AAExB,IAAA,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;AACjD,IAAA,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAE,eAAe,CAAC,CAAC;IAErD,OAAO,MAAM,EAAE,CAAC;AAClB,CAAC;AAED,SAAe,eAAe,CAAC,EAAU,EAAE,KAAiB,EAAA;;AAC1D,QAAA,MAAM,MAAM,GAAG,UAAU,CAAC,EAAE,CAAC,CAAC;QAC9B,IAAI,MAAM,KAAK,IAAI;YAAE,OAAO;QAE5B,MAAM,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACzC,QAAA,IAAI,CAAC,MAAM;YAAE,OAAO;QAEpB,MAAM,IAAI,GAAG,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;AACzC,QAAA,IAAI,CAAC,IAAI;YAAE,OAAO;QAElB,IAAI,QAAQ,GAAG,MAAM,CAAC,YAAY,CAAC,0BAA0B,CAAC,CAAC;AAC/D,QAAA,QAAQ,GAAG,QAAQ,KAAK,IAAI,GAAG,IAAI,GAAG,QAAQ,CAAC,WAAW,EAAE,CAAC;QAC7D,IAAI,QAAQ,KAAK,EAAE,IAAI,QAAQ,KAAK,MAAM,IAAI,QAAQ,KAAK,MAAM,EAAE;YACjE,MAAM,MAAM,CAAC,iBAAiB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AAC9C,SAAA;KACF,CAAA,CAAA;AAAA,CAAA;AAEK,SAAU,cAAc,CAAC,EAAU,EAAA;AACvC,IAAA,MAAM,YAAY,GAAG,aAAa,CAAC,EAAE,CAAC,CAAC;AACvC,IAAA,IAAI,YAAY,EAAE;AAChB,QAAA,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;AACrD,KAAA;AAED,IAAA,MAAM,eAAe,GAAG,gBAAgB,CAAC,EAAE,CAAC,CAAC;AAC7C,IAAA,IAAI,eAAe,EAAE;AACnB,QAAA,MAAM,CAAC,mBAAmB,CAAC,UAAU,EAAE,eAAe,CAAC,CAAC;AACzD,KAAA;IAED,UAAU,CAAC,EAAE,CAAC,IAAI,UAAU,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;AAE3C,IAAA,OAAO,aAAa,CAAC,EAAE,CAAC,CAAC;AACzB,IAAA,OAAO,gBAAgB,CAAC,EAAE,CAAC,CAAC;AAC5B,IAAA,OAAO,UAAU,CAAC,EAAE,CAAC,CAAC;AACxB;;;;"}