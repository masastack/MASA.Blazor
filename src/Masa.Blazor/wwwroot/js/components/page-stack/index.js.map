{"version":3,"file":"index.js","sources":["../../../../../Masa.Blazor.JS/src/components/page-stack/index.ts"],"sourcesContent":["import { convertToUnit } from \"utils/helper\";\r\n\r\nconst dotnetRefs: { [prop: number]: DotNet.DotNetObject } = {};\r\nconst clickHandlers: { [prop: number]: (e: MouseEvent) => void } = {};\r\nconst popstateHandlers: { [prop: number]: () => void } = {};\r\nlet nextId = 0;\r\n\r\nexport function attachListener(handle: DotNet.DotNetObject) {\r\n  const id = nextId;\r\n  const clickHandler = (event: MouseEvent) => onDocumentClick(id, event);\r\n  const popstateHandler = () =>\r\n    handle.invokeMethodAsync(\"Popstate\", window.location.pathname);\r\n  clickHandlers[id] = clickHandler;\r\n  popstateHandlers[id] = popstateHandler;\r\n  dotnetRefs[id] = handle;\r\n\r\n  document.addEventListener(\"click\", clickHandler);\r\n  window.addEventListener(\"popstate\", popstateHandler);\r\n\r\n  return nextId++;\r\n}\r\n\r\nasync function onDocumentClick(id: number, event: MouseEvent) {\r\n  const dotnet = dotnetRefs[id];\r\n  if (dotnet === null) return;\r\n\r\n  const anchor = event.target.closest(\"a\");\r\n  if (!anchor) return;\r\n\r\n  const href = anchor.getAttribute(\"href\");\r\n  if (!href) return;\r\n\r\n  let strategy = anchor.getAttribute(\"data-page-stack-strategy\");\r\n  strategy = strategy === null ? null : strategy.toLowerCase();\r\n  if (strategy === \"\" || strategy === \"true\" || strategy === \"push\") {\r\n    if (!document.querySelector(\"[page-stack-id]\")) {\r\n      blockScroll();\r\n    }\r\n\r\n    await dotnet.invokeMethodAsync(\"Push\", href);\r\n  }\r\n}\r\n\r\nexport function blockScroll() {\r\n  const doc = document.documentElement;\r\n\r\n  if (doc.classList.contains(\"m-page-stack-scroll-blocked\")) {\r\n    return;\r\n  }\r\n\r\n  doc.style.setProperty(\"--m-page-stack-scroll-x\", convertToUnit(-doc.scrollLeft));\r\n  doc.style.setProperty(\"--m-page-stack-scroll-y\", convertToUnit(-doc.scrollTop));\r\n  doc.classList.add(\"m-page-stack-scroll-blocked\");\r\n}\r\n\r\nexport function unblockScroll() {\r\n  const doc = document.documentElement;\r\n  if (!doc.classList.contains(\"m-page-stack-scroll-blocked\")) {\r\n    return;\r\n  }\r\n\r\n  const x = parseFloat(doc.style.getPropertyValue(\"--m-page-stack-scroll-x\"));\r\n  const y = parseFloat(doc.style.getPropertyValue(\"--m-page-stack-scroll-y\"));\r\n\r\n  const scrollBehavior = doc.style.scrollBehavior;\r\n\r\n  doc.style.scrollBehavior = \"auto\";\r\n  doc.style.removeProperty(\"--m-page-stack-scroll-x\");\r\n  doc.style.removeProperty(\"--m-page-stack-scroll-y\");\r\n  doc.classList.remove(\"m-page-stack-scroll-blocked\");\r\n\r\n  doc.scrollLeft = -x;\r\n  doc.scrollTop = -y;\r\n\r\n  doc.style.scrollBehavior = scrollBehavior;\r\n}\r\n\r\nexport function detachListener(id: number) {\r\n  const clickHandler = clickHandlers[id];\r\n  if (clickHandler) {\r\n    document.removeEventListener(\"click\", clickHandler);\r\n  }\r\n\r\n  const popstateHandler = popstateHandlers[id];\r\n  if (popstateHandler) {\r\n    window.removeEventListener(\"popstate\", popstateHandler);\r\n  }\r\n\r\n  dotnetRefs[id] && dotnetRefs[id].dispose();\r\n\r\n  delete clickHandlers[id];\r\n  delete popstateHandlers[id];\r\n  delete dotnetRefs[id];\r\n}\r\n"],"names":["dotnetRefs","clickHandlers","popstateHandlers","nextId","attachListener","handle","id","clickHandler","event","dotnet","anchor","target","closest","href","getAttribute","strategy","toLowerCase","document","querySelector","blockScroll","invokeMethodAsync","onDocumentClick","popstateHandler","window","location","pathname","addEventListener","doc","documentElement","classList","contains","style","setProperty","convertToUnit","scrollLeft","scrollTop","add","unblockScroll","x","parseFloat","getPropertyValue","y","scrollBehavior","removeProperty","remove","detachListener","removeEventListener","dispose"],"mappings":"yFAEA,MAAMA,EAAsD,CAAA,EACtDC,EAA6D,CAAA,EAC7DC,EAAmD,CAAA,EACzD,IAAIC,EAAS,EAEP,SAAUC,EAAeC,GAC7B,MAAMC,EAAKH,EACLI,EAAgBC,GAaxB,SAA+BF,EAAYE,4CACzC,MAAMC,EAAST,EAAWM,GAC1B,GAAe,OAAXG,EAAiB,OAErB,MAAMC,EAASF,EAAMG,OAAOC,QAAQ,KACpC,IAAKF,EAAQ,OAEb,MAAMG,EAAOH,EAAOI,aAAa,QACjC,IAAKD,EAAM,OAEX,IAAIE,EAAWL,EAAOI,aAAa,4BACnCC,EAAwB,OAAbA,EAAoB,KAAOA,EAASC,cAC9B,KAAbD,GAAgC,SAAbA,GAAoC,SAAbA,IACvCE,SAASC,cAAc,oBAC1BC,UAGIV,EAAOW,kBAAkB,OAAQP,MAE1C,CAhC6CQ,CAAgBf,EAAIE,GAC1Dc,EAAkB,IACtBjB,EAAOe,kBAAkB,WAAYG,OAAOC,SAASC,UAQvD,OAPAxB,EAAcK,GAAMC,EACpBL,EAAiBI,GAAMgB,EACvBtB,EAAWM,GAAMD,EAEjBY,SAASS,iBAAiB,QAASnB,GACnCgB,OAAOG,iBAAiB,WAAYJ,GAE7BnB,GACT,UAuBgBgB,IACd,MAAMQ,EAAMV,SAASW,gBAEjBD,EAAIE,UAAUC,SAAS,iCAI3BH,EAAII,MAAMC,YAAY,0BAA2BC,GAAeN,EAAIO,aACpEP,EAAII,MAAMC,YAAY,0BAA2BC,GAAeN,EAAIQ,YACpER,EAAIE,UAAUO,IAAI,+BACpB,UAEgBC,IACd,MAAMV,EAAMV,SAASW,gBACrB,IAAKD,EAAIE,UAAUC,SAAS,+BAC1B,OAGF,MAAMQ,EAAIC,WAAWZ,EAAII,MAAMS,iBAAiB,4BAC1CC,EAAIF,WAAWZ,EAAII,MAAMS,iBAAiB,4BAE1CE,EAAiBf,EAAII,MAAMW,eAEjCf,EAAII,MAAMW,eAAiB,OAC3Bf,EAAII,MAAMY,eAAe,2BACzBhB,EAAII,MAAMY,eAAe,2BACzBhB,EAAIE,UAAUe,OAAO,+BAErBjB,EAAIO,YAAcI,EAClBX,EAAIQ,WAAaM,EAEjBd,EAAII,MAAMW,eAAiBA,CAC7B,CAEM,SAAUG,EAAevC,GAC7B,MAAMC,EAAeN,EAAcK,GAC/BC,GACFU,SAAS6B,oBAAoB,QAASvC,GAGxC,MAAMe,EAAkBpB,EAAiBI,GACrCgB,GACFC,OAAOuB,oBAAoB,WAAYxB,GAGzCtB,EAAWM,IAAON,EAAWM,GAAIyC,iBAE1B9C,EAAcK,UACdJ,EAAiBI,UACjBN,EAAWM,EACpB"}