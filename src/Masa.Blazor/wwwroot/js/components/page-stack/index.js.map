{"version":3,"file":"index.js","sources":["../../../../../Masa.Blazor.JS/src/components/page-stack/index.ts"],"sourcesContent":["const dotnetRefs: { [prop: number]: DotNet.DotNetObject } = {};\r\nconst clickHandlers: { [prop: number]: (e: MouseEvent) => void } = {};\r\nconst popstateHandlers: { [prop: number]: () => void } = {};\r\nlet nextId = 0;\r\n\r\nexport function attachListener(handle: DotNet.DotNetObject) {\r\n  const id = nextId;\r\n  const clickHandler = (event: MouseEvent) => onDocumentClick(id, event);\r\n  const popstateHandler = () =>\r\n    handle.invokeMethodAsync(\"Popstate\", window.location.pathname);\r\n  clickHandlers[id] = clickHandler;\r\n  popstateHandlers[id] = popstateHandler;\r\n  dotnetRefs[id] = handle;\r\n\r\n  document.addEventListener(\"click\", clickHandler);\r\n  window.addEventListener(\"popstate\", popstateHandler);\r\n\r\n  return nextId++;\r\n}\r\n\r\nasync function onDocumentClick(id: number, event: MouseEvent) {\r\n  const dotnet = dotnetRefs[id];\r\n  if (dotnet === null) return;\r\n\r\n  const anchor = event.target.closest(\"a\");\r\n  if (!anchor) return;\r\n\r\n  const href = anchor.getAttribute(\"href\");\r\n  if (!href) return;\r\n\r\n  let strategy = anchor.getAttribute(\"data-page-stack-strategy\");\r\n  strategy = strategy === null ? null : strategy.toLowerCase();\r\n  if (strategy === \"\" || strategy === \"true\" || strategy === \"push\") {\r\n    await dotnet.invokeMethodAsync(\"Push\", href);\r\n  }\r\n}\r\n\r\nexport function detachListener(id: number) {\r\n  const clickHandler = clickHandlers[id];\r\n  if (clickHandler) {\r\n    document.removeEventListener(\"click\", clickHandler);\r\n  }\r\n\r\n  const popstateHandler = popstateHandlers[id];\r\n  if (popstateHandler) {\r\n    window.removeEventListener(\"popstate\", popstateHandler);\r\n  }\r\n\r\n  dotnetRefs[id] && dotnetRefs[id].dispose();\r\n\r\n  delete clickHandlers[id];\r\n  delete popstateHandlers[id];\r\n  delete dotnetRefs[id];\r\n}\r\n"],"names":["dotnetRefs","clickHandlers","popstateHandlers","nextId","attachListener","handle","id","clickHandler","event","dotnet","anchor","target","closest","href","getAttribute","strategy","toLowerCase","invokeMethodAsync","onDocumentClick","popstateHandler","window","location","pathname","document","addEventListener","detachListener","removeEventListener","dispose"],"mappings":"8CAAA,MAAMA,EAAsD,CAAA,EACtDC,EAA6D,CAAA,EAC7DC,EAAmD,CAAA,EACzD,IAAIC,EAAS,EAEP,SAAUC,EAAeC,GAC7B,MAAMC,EAAKH,EACLI,EAAgBC,GAaxB,SAA+BF,EAAYE,4CACzC,MAAMC,EAAST,EAAWM,GAC1B,GAAe,OAAXG,EAAiB,OAErB,MAAMC,EAASF,EAAMG,OAAOC,QAAQ,KACpC,IAAKF,EAAQ,OAEb,MAAMG,EAAOH,EAAOI,aAAa,QACjC,IAAKD,EAAM,OAEX,IAAIE,EAAWL,EAAOI,aAAa,4BACnCC,EAAwB,OAAbA,EAAoB,KAAOA,EAASC,cAC9B,KAAbD,GAAgC,SAAbA,GAAoC,SAAbA,UACtCN,EAAOQ,kBAAkB,OAAQJ,MAE1C,CA5B6CK,CAAgBZ,EAAIE,GAC1DW,EAAkB,IACtBd,EAAOY,kBAAkB,WAAYG,OAAOC,SAASC,UAQvD,OAPArB,EAAcK,GAAMC,EACpBL,EAAiBI,GAAMa,EACvBnB,EAAWM,GAAMD,EAEjBkB,SAASC,iBAAiB,QAASjB,GACnCa,OAAOI,iBAAiB,WAAYL,GAE7BhB,GACT,CAmBM,SAAUsB,EAAenB,GAC7B,MAAMC,EAAeN,EAAcK,GAC/BC,GACFgB,SAASG,oBAAoB,QAASnB,GAGxC,MAAMY,EAAkBjB,EAAiBI,GACrCa,GACFC,OAAOM,oBAAoB,WAAYP,GAGzCnB,EAAWM,IAAON,EAAWM,GAAIqB,iBAE1B1B,EAAcK,UACdJ,EAAiBI,UACjBN,EAAWM,EACpB"}