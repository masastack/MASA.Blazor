{"version":3,"file":"index.js","sources":["../../../../../Masa.Blazor.JS/src/events/extra.ts","../../../../../Masa.Blazor.JS/src/utils/blazor.ts","../../../../../Masa.Blazor.JS/src/components/input/index.ts"],"sourcesContent":["import { getEventTarget } from \"../utils/helper\";\r\nimport { parseDragEvent, parseMouseEvent, parseTouchEvent } from \"./EventType\";\r\n\r\nexport function registerExtraMouseEvent(eventType: string, eventName: string) {\r\n  if (Blazor) {\r\n    Blazor.registerCustomEventType(eventType, {\r\n      browserEventName: eventName,\r\n      createEventArgs: e => createSharedEventArgs(\"mouse\", e)\r\n    })\r\n  }\r\n}\r\n\r\nexport function registerExtraTouchEvent(eventType: string, eventName: string) {\r\n  if (Blazor) {\r\n    Blazor.registerCustomEventType(eventType, {\r\n      browserEventName: eventName,\r\n      createEventArgs: e => createSharedEventArgs(\"touch\", e)\r\n    })\r\n  }\r\n}\r\n\r\nexport function registerExtraDropEvent(eventType: string, eventName: string) {\r\n  if (Blazor) {\r\n    Blazor.registerCustomEventType(eventType, {\r\n      browserEventName: eventName,\r\n      createEventArgs: (e: DragEvent) => {\r\n        const eventArgs = parseDragEvent(e);\r\n        const value = e.dataTransfer.getData('data-value');\r\n        const offsetX = e.dataTransfer.getData('offsetX');\r\n        const offsetY = e.dataTransfer.getData('offsetY');\r\n\r\n        eventArgs.dataTransfer['data'] = {\r\n          value,\r\n          offsetX: Number(offsetX),\r\n          offsetY: Number(offsetY)\r\n        }\r\n\r\n        return eventArgs;\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport function createSharedEventArgs(type: \"mouse\" | \"touch\", e: Event,) {\r\n  let args = { target: {} }\r\n  if (type === 'mouse') {\r\n    args = {\r\n      ...args,\r\n      ...parseMouseEvent(e as MouseEvent)\r\n    }\r\n  } else if (type === 'touch') {\r\n    args = {\r\n      ...args,\r\n      ...parseTouchEvent(e as TouchEvent)\r\n    }\r\n  }\r\n\r\n  args.target = getEventTarget(e.target);\r\n\r\n  return args;\r\n}","// @event:stopPropagation only works in Blazor,\r\n// so need to capture it manually.\r\nexport function checkIfStopPropagationExistsInComposedPath(\r\n  event: Event,\r\n  eventName: string,\r\n  util: EventTarget\r\n) {\r\n  let stopPropagation = false;\r\n\r\n  for (const eventTarget of event.composedPath()) {\r\n    if (eventTarget === util) {\r\n      break;\r\n    }\r\n\r\n    if (checkIfStopPropagation(eventTarget, eventName)) {\r\n      stopPropagation = true;\r\n      break;\r\n    }\r\n  }\r\n\r\n  return stopPropagation;\r\n}\r\n\r\nfunction checkIfStopPropagation(eventTarget: EventTarget, eventName: string) {\r\n  const nestProps = [\"_blazorEvents_1\", \"stopPropagationFlags\", eventName];\r\n\r\n  let isFlag = eventTarget;\r\n  let i = 0;\r\n  while (isFlag[nestProps[i]]) {\r\n    isFlag = isFlag[nestProps[i]];\r\n    i++;\r\n  }\r\n\r\n  return i == nestProps.length && typeof isFlag === \"boolean\" && isFlag;\r\n}","import { parseChangeEvent } from \"events/EventType\";\r\nimport { createSharedEventArgs } from \"events/extra\";\r\nimport { checkIfStopPropagationExistsInComposedPath } from \"utils/blazor\";\r\n\r\nclass Input {\r\n  input: HTMLInputElement | HTMLTextAreaElement;\r\n  inputSlot: Element;\r\n  dotnetHelper: DotNet.DotNetObject;\r\n  debounce: number;\r\n\r\n  constructor(\r\n    dotnetHelper: DotNet.DotNetObject,\r\n    input: HTMLInputElement | HTMLTextAreaElement,\r\n    inputSlot: Element,\r\n    debounce: number\r\n  ) {\r\n    this.input = input;\r\n    this.inputSlot = inputSlot;\r\n    this.dotnetHelper = dotnetHelper;\r\n    this.debounce = debounce;\r\n\r\n    this.#registerAllEvents();\r\n  }\r\n\r\n  setValue(value: any) {\r\n    this.input.value = value;\r\n  }\r\n\r\n  #registerAllEvents() {\r\n    if (!this.input || !this.inputSlot) return;\r\n\r\n    this.#registerClickEvent();\r\n\r\n    this.#registerMouseUpEvent();\r\n\r\n    if (\r\n      !(\r\n        this.input &&\r\n        (this.input instanceof HTMLInputElement ||\r\n          this.input instanceof HTMLTextAreaElement)\r\n      )\r\n    )\r\n      return;\r\n\r\n    this.#registerInputEvent();\r\n  }\r\n\r\n  #registerInputEvent() {\r\n    let compositionInputting = false;\r\n\r\n    let timeout;\r\n\r\n    this.input.addEventListener(\"compositionstart\", (_) => {\r\n      compositionInputting = true;\r\n    });\r\n\r\n    this.input.addEventListener(\"compositionend\", (event: CompositionEvent) => {\r\n      compositionInputting = false;\r\n\r\n      const changeEventArgs = parseChangeEvent(event);\r\n      changeEventArgs.value = this.input.value;\r\n\r\n      if (\r\n        this.input.maxLength !== -1 &&\r\n        changeEventArgs.value.length > this.input.maxLength\r\n      ) {\r\n        changeEventArgs.value = changeEventArgs.value.substring(\r\n          0,\r\n          this.input.maxLength\r\n        );\r\n      }\r\n\r\n      this.dotnetHelper.invokeMethodAsync(\"OnInput\", changeEventArgs);\r\n    });\r\n\r\n    this.input.addEventListener(\"input\", (event: ChangeEvent) => {\r\n      if (compositionInputting) return;\r\n\r\n      var changeEventArgs = parseChangeEvent(event);\r\n\r\n      clearTimeout(timeout);\r\n      timeout = setTimeout(() => {\r\n        this.dotnetHelper.invokeMethodAsync(\"OnInput\", changeEventArgs);\r\n      }, this.debounce);\r\n    });\r\n\r\n    this.input.addEventListener('change', (event: ChangeEvent) => {\r\n      var changeEventArgs = parseChangeEvent(event);\r\n      this.#formatNumberValue(event);\r\n\r\n      this.dotnetHelper.invokeMethodAsync(\"OnChange\", changeEventArgs);\r\n    })\r\n  }\r\n\r\n  #formatNumberValue(event: ChangeEvent) {\r\n    if (event.target.type === \"number\") {\r\n      const value = event.target.value;\r\n      const valueAsNumber = event.target.valueAsNumber;\r\n      if (!!value && value !== valueAsNumber.toString()) {\r\n        this.input.value = isNaN(valueAsNumber)\r\n        ? \"\"\r\n        : valueAsNumber.toString();\r\n      }\r\n    }\r\n  }\r\n\r\n  #registerClickEvent() {\r\n    this.inputSlot.addEventListener(\"click\", (e) => {\r\n      if (\r\n        checkIfStopPropagationExistsInComposedPath(e, \"click\", this.inputSlot)\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      var eventArgs = createSharedEventArgs(\"mouse\", e);\r\n      this.dotnetHelper.invokeMethodAsync(\"OnClick\", eventArgs);\r\n    });\r\n  }\r\n\r\n  #registerMouseUpEvent() {\r\n    this.inputSlot.addEventListener(\"mouseup\", (e) => {\r\n      if (\r\n        checkIfStopPropagationExistsInComposedPath(e, \"mouseup\", this.inputSlot)\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      var eventArgs = createSharedEventArgs(\"mouse\", e);\r\n      this.dotnetHelper.invokeMethodAsync(\"OnMouseUp\", eventArgs);\r\n    });\r\n  }\r\n}\r\n\r\nfunction init(\r\n  dotnetHelper: DotNet.DotNetObject,\r\n  input: HTMLInputElement | HTMLTextAreaElement,\r\n  inputSlot: Element,\r\n  debounce: number\r\n) {\r\n  return new Input(dotnetHelper, input, inputSlot, debounce);\r\n}\r\n\r\nexport { init };\r\n"],"names":[],"mappings":"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"}