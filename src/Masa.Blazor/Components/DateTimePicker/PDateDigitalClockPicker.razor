@namespace Masa.Blazor.Presets
@typeparam TValue
@inherits PDateTimePickerView<TValue>
@inject I18n I18n

<MMenu Value="_menu"
       ValueChanged="OnMenuChanged"
       CloseOnContentClick="false"
       OffsetY
       NudgeBottom="1"
       ActivatorContent="@ActivatorContent"
       ContentClass="@BasePickerBlock.AddClass(Block.Build()).Build()">
    <ChildContent>
        <PDateDigitalClockPickerView @bind-Value="_internalDateTime"
                                     AllowedDates="@AllowedDates"
                                     AllowedHours="@AllowedHours"
                                     AllowedMinutes="@AllowedMinutes"
                                     AllowedSeconds="@AllowedSeconds"
                                     Color="@Color"
                                     DayFormat="@DayFormat"
                                     Disabled="@Disabled"
                                     FirstDayOfWeek="@FirstDayOfWeek"
                                     TimeFormat="@TimeFormat"
                                     Locale="@Locale"
                                     Max="@Max"
                                     Min="@Min"
                                     MonthFormat="@MonthFormat"
                                     NextIcon="@NextIcon"
                                     PrevIcon="@PrevIcon"
                                     Reactive="@Reactive"
                                     Readonly="@Reactive"
                                     Scrollable="@Scrollable"
                                     ShowAdjacentMonths="@ShowAdjacentMonths"
                                     ShowCurrent="@ShowCurrent"
                                     ShowWeek="@ShowWeek"
                                     UseSeconds="@UseSeconds"
                                     WeekdayFormat="@WeekdayFormat"
                                     YearFormat="@YearFormat"
                                     YearIcon="@YearIcon"
                                     Dark="Dark"
                                     Light="@Light">
        </PDateDigitalClockPickerView>
        <MDivider />
        <div class="@BasePickerBlock.Element("actions")">
            <MButton Color="primary"
                     Text
                     OnClick="OnConfirm"
                     Dark="@Dark"
                     Light="@Light">
                @I18n.T("$masaBlazor.ok")
            </MButton>
        </div>
    </ChildContent>
</MMenu>

@code {

    [Parameter]
    public RenderFragment<ActivatorProps>? ActivatorContent { get; set; }

    private Block Block => new("m-date-digital-clock-picker");

    private bool _menu;

    private TValue? _internalDateTime;

    private void OnMenuChanged(bool val)
    {
        _menu = val;

        if (_menu)
        {
            _internalDateTime = Value;
        }
    }

    private async Task OnConfirm()
    {
        _menu = false;
        await ValueChanged.InvokeAsync(_internalDateTime);
    }

}
