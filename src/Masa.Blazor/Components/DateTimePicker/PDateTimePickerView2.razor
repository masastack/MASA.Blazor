@namespace Masa.Blazor.Presets
@inherits PDateTimePickerViewBase<TValue>
@typeparam TValue

<div class="d-inline-flex flex-column">
    <MTabs @bind-Value="_tabValue" FixedTabs>
        <MTab Value="@DATE" Ripple="false">
            @if (DateOnly.HasValue)
            {
                <span class="mr-1">
                    @YearTitle
                </span>
                <span>
                    @DateTitle
                </span>
            }
            else
            {
                <MIcon Class="mr-1">mdi-calendar</MIcon>
            }
        </MTab>
        <MTab Value="@TIME" Ripple="false">
            @if (TimeOnly.HasValue)
            {
                @TimeOnly.Value.Hour.ToString("00")
                <span>:</span>
                @TimeOnly.Value.Minute.ToString("00")
                @if (UseSeconds)
                {
                    <span>:</span>
                    @TimeOnly.Value.Second
                }

                if (TimeFormat == TimeFormat.AmPm)
                {
                    <span class="ml-1">
                        @TimeOnly.Value.ToString("tt", CultureInfo.CurrentCulture)
                    </span>
                }
            }
            else
            {
                <MIcon Class="mr-1">mdi-clock-outline</MIcon>
            }
        </MTab>
    </MTabs>
    <MWindow Value="_tabValue">
        <MWindowItem Value="DATE" Eager Transition="@Transition">
            <MDatePicker Value="DateOnly"
                         ValueChanged="DateChanged"
                         TValue="DateOnly?"
                         AllowedDates="@AllowedDates"
                         ActivePicker="@ActiveDatePicker"
                         Color="@Color"
                         DayFormat="@DayFormat"
                         Disabled="@Disabled"
                         FirstDayOfWeek="@FirstDayOfWeek"
                         HeaderDateFormat="@HeaderDateFormat"
                         Locale="@Locale"
                         Max="@MaxDate"
                         Min="@MinDate"
                         MonthFormat="@MonthFormat"
                         NoTitle
                         NextIcon="@NextIcon"
                         PrevIcon="@PrevIcon"
                         Reactive="@Reactive"
                         Readonly="@Readonly"
                         Scrollable="@Scrollable"
                         ShowAdjacentMonths="@ShowAdjacentMonths"
                         ShowCurrent="@ShowCurrent"
                         ShowWeek="@ShowWeek"
                         TitleDateFormat="@TitleDateFormat"
                         WeekdayFormat="@WeekdayFormat"
                         YearFormat="@YearFormat"
                         YearIcon="@YearIcon"
                         Dark="@Dark"
                         Light="@Light"
                         @ref="_datePicker">
            </MDatePicker>
        </MWindowItem>
        <MWindowItem Value="TIME" Eager Transition="@Transition">
            <MTimePicker Value="TimeOnly"
                         ValueChanged="TimeChanged"
                         AllowedHours="@AllowedHours"
                         AllowedMinutes="@AllowedMinutes"
                         AllowedSeconds="@AllowedSeconds"
                         Color="@Color"
                         Disabled="@Disabled"
                         Format="@TimeFormat"
                         Max="@MaxTime"
                         Min="@MinTime"
                         NoTitle
                         Readonly="@Readonly"
                         Scrollable="@Scrollable"
                         UseSeconds="@UseSeconds"
                         Dark="@Dark"
                         Light="@Light"
                         OnHourClick="OnHourClick"
                         @bind-Activepicker="@_timeActivePicker"
                         @ref="_timePicker">
            </MTimePicker>
            <span style="position: absolute; top: 1px; left: 16px; opacity: 0.6;">
                @SelectingTime
            </span>
            <span style="position: absolute; top: 1px; right: 0;">
                <MButton Icon
                         OnClick="OnPrevClick"
                         Disabled="@((int)_timeActivePicker <= 1)">
                    <MIcon>$prev</MIcon>
                </MButton>
                <MButton Icon
                         OnClick="OnNextClick"
                         Disabled="@((int)_timeActivePicker == SupportedMaxTimePickerType)">
                    <MIcon>$next</MIcon>
                </MButton>
            </span>
        </MWindowItem>
    </MWindow>
</div>
